<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ä¸€ä¸ªå¡ç‰Œæ¸¸æˆçš„è®¾æƒ³</title>
    <link href="/2025/06/28/%E4%B8%80%E4%B8%AA%E5%8D%A1%E7%89%8C%E6%B8%B8%E6%88%8F%E7%9A%84%E8%AE%BE%E6%83%B3/"/>
    <url>/2025/06/28/%E4%B8%80%E4%B8%AA%E5%8D%A1%E7%89%8C%E6%B8%B8%E6%88%8F%E7%9A%84%E8%AE%BE%E6%83%B3/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘åœ¨å­¦æ ¡é‡Œå’ŒåŒå­¦åˆ©ç”¨å¥½å¤šé±¼é›†å¡å¤§ä½œæˆ˜çš„å¡è®¾è®¡äº†ä¸€ä¸ªå›åˆåˆ¶çš„å¡ç‰Œæ¸¸æˆï¼Œç°åœ¨åœ¨å°è¯•å†™æˆä¸€ä¸ªæ¡Œé¢æ¸¸æˆã€‚ç­‰åˆ°å¤§è‡´æˆå‹äº†å°±æŠŠæºç æŠ•åˆ°Githubä¸Šï¼Œç„¶åæŠŠè¿™ä¸ªè´´å­åšæˆè¿™ä¸ªé¡¹ç›®çš„å®˜æ–¹ç½‘é¡µã€‚ä½†æ˜¯é«˜ä¸‰æ¯”è¾ƒå¿™ï¼Œå¯èƒ½æ¯”è¾ƒæ…¢å§</p>]]></content>
    
    
    
    <tags>
      
      <tag>é¡¹ç›®è¯´æ˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OrangePiä¸Šè¿è¡ŒStable Diffusion</title>
    <link href="/2025/06/28/OrangePi%E4%B8%8A%E8%BF%90%E8%A1%8CStable-Diffusion/"/>
    <url>/2025/06/28/OrangePi%E4%B8%8A%E8%BF%90%E8%A1%8CStable-Diffusion/</url>
    
    <content type="html"><![CDATA[<p>Stable Diffusionæ˜¯ç›®å‰ä¸»æµçš„AIç»˜å›¾æ¨¡å‹ï¼Œä½†ä¸€èˆ¬è¦æ±‚æœ‰è‹±ä¼Ÿè¾¾çš„ç‹¬ç«‹æ˜¾å¡ï¼Œéš¾ä»¥åœ¨OrangePiè¿™ç§armæ¶æ„çš„è®¾å¤‡ä¸Šè¿è¡Œã€‚æˆ‘å°è¯•äº†åœ¨æˆ‘çš„OrangePi5Plusä¸Šè¿è¡Œäº†huggingfaceä¸Šçš„sd-1.5æ¨¡å‹ï¼Œç»è¿‡åˆ°onnxå†åˆ°rknnçš„æ¨¡å‹è½¬åŒ–ï¼Œæœ€åè¿˜åšäº†ä¸€ä¸ªwebUIã€‚ä¸‹é¢ç»™å‡ºæµç¨‹ï¼Œæ–¹ä¾¿å‚è€ƒã€‚ </p><p><strong>æé†’ï¼š</strong>è¯¥æ–¹æ¡ˆæœ€åç²¾åº¦å®é™…ä¸Šä¸é«˜ï¼Œæ²¡æœ‰å¤ªå¤§çš„å®ç”¨ä»·å€¼ï¼Œå› æ­¤åªç”¨äºå­¦ä¹ å‚è€ƒã€‚</p><h1 id="ææ–™å‡†å¤‡"><a href="#ææ–™å‡†å¤‡" class="headerlink" title="ææ–™å‡†å¤‡"></a>ææ–™å‡†å¤‡</h1><ul><li>ä¸€å°x86çš„ä¸»æœºï¼Œè¿è¡Œäº†Linuxç³»ç»Ÿ </li><li>Windowsä¸»æœºï¼ˆå¯é€‰ï¼‰ </li><li>å¯ä»¥è®¿é—®<a href="https://huggingface.co/">https://huggingface.co</a>å’Œ<a href="https://github.com/">https://github.com</a>çš„ç½‘ç»œ </li><li>æœ€å¥½æœ‰pipï¼ŒAnacondaå’Œhuggingfaceçš„é•œåƒ,æ¯”å¦‚huggingfaceçš„é•œåƒæˆ‘ä½¿ç”¨çš„æ˜¯<a href="https://hf-mirror.com/">https://hf-mirror.com/</a></li></ul><h1 id="ä¸»æœºé˜¶æ®µ"><a href="#ä¸»æœºé˜¶æ®µ" class="headerlink" title="ä¸»æœºé˜¶æ®µ"></a>ä¸»æœºé˜¶æ®µ</h1><p>åœ¨x86Linuxä¸»æœºä¸Šè¿›è¡Œï¼Œæœ€å¥½é¢„ç•™è‡³å°‘90GBçš„ç¡¬ç›˜ç©ºé—´ï¼Œä¿è¯è‡³å°‘16GBçš„è¿è¡Œå†…å­˜ï¼ˆä¸ç„¶å¯èƒ½è¢«killè¿›ç¨‹ï¼‰.<br><code>orange_pi_sd_project/       # é¡¹ç›®æ ¹ç›®å½• </code><br><code>â”œâ”€â”€ scripts/                 # å­˜æ”¾æ‰€æœ‰è½¬æ¢è„šæœ¬</code><br><code>â”‚   â”œâ”€â”€ 01_merge_models.py   # æ¨¡å‹åˆå¹¶è„šæœ¬ </code><br><code>â”‚   â”œâ”€â”€ 02_convert_to_onnx.py # ONNXè½¬æ¢è„šæœ¬ </code><br><code>â”‚   â””â”€â”€ 03_convert_to_rknn.py # RKNNè½¬æ¢è„šæœ¬ </code><br><code>â”œâ”€â”€ working/                # å·¥ä½œç›®å½•ï¼ˆå­˜æ”¾ä¸­é—´æ–‡ä»¶ï¼‰</code><br><code>â”‚   â”œâ”€â”€ merged_models/      # åˆå¹¶åçš„æ¨¡å‹ </code><br><code>â”‚   â”œâ”€â”€ onnx_models/        # ONNXæ ¼å¼æ¨¡å‹ </code><br><code>â”‚   â””â”€â”€ rknn_models/        # æœ€ç»ˆRKNNæ¨¡å‹ </code><br><code>â”€â”€ calib_data/             # æ ¡å‡†æ•°æ®é›†</code></p><h2 id="æ¨¡å‹ä¸‹è½½"><a href="#æ¨¡å‹ä¸‹è½½" class="headerlink" title="æ¨¡å‹ä¸‹è½½"></a>æ¨¡å‹ä¸‹è½½</h2><p>ä»huggingfaceä¸Šä¸‹è½½sd-v1.5åŸå§‹æ¨¡å‹å’ŒLCM-LoRAé€‚é…å™¨ã€‚</p><h2 id="åˆå¹¶æ¨¡å‹"><a href="#åˆå¹¶æ¨¡å‹" class="headerlink" title="åˆå¹¶æ¨¡å‹"></a>åˆå¹¶æ¨¡å‹</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> StableDiffusionPipeline<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> os<br>LOCAL_SD15_PATH = <span class="hljs-string">&quot;./models/stable-diffusion-v1-5&quot;</span>  <span class="hljs-comment"># SD1.5åŸå§‹æ¨¡å‹ç›®å½•</span><br>LOCAL_LCM_LORA_PATH = <span class="hljs-string">&quot;./models/lcm-lora-sdv1-5&quot;</span>    <span class="hljs-comment"># LCM-LoRAé€‚é…å™¨ç›®å½•</span><br>MERGED_PATH = <span class="hljs-string">&quot;./lcm_sd15_merged&quot;</span>                   <span class="hljs-comment"># åˆå¹¶åæ¨¡å‹ä¿å­˜è·¯å¾„</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_model_directories</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;åªæ£€æŸ¥å¿…è¦çš„æ ¸å¿ƒæ–‡ä»¶&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># SD1.5 å¿…é¡»çš„æ–‡ä»¶</span><br>    sd_required = [<br>        <span class="hljs-string">&quot;model_index.json&quot;</span>,<br>        <span class="hljs-string">&quot;unet/config.json&quot;</span>,<br>        <span class="hljs-string">&quot;unet/diffusion_pytorch_model.bin&quot;</span>,<br>        <span class="hljs-string">&quot;vae/config.json&quot;</span>,<br>        <span class="hljs-string">&quot;text_encoder/config.json&quot;</span><br>    ]    <br>    <span class="hljs-comment"># LCM-LoRA åªéœ€è¦æƒé‡æ–‡ä»¶</span><br>    lcm_required = [<br>        <span class="hljs-string">&quot;unet/diffusion_pytorch_model.safetensors&quot;</span><br>    ]    <br>    missing_files = []    <br>    <span class="hljs-comment"># éªŒè¯ SD1.5</span><br>    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> sd_required:<br>        path = os.path.join(LOCAL_SD15_PATH, file)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path):<br>            missing_files.append(path)    <br>    <span class="hljs-comment"># éªŒè¯ LCM-LoRA</span><br>    <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> lcm_required:<br>        path = os.path.join(LOCAL_LCM_LORA_PATH, file)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path):<br>            missing_files.append(path)   <br>    <span class="hljs-keyword">if</span> missing_files:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âŒ é”™è¯¯: ä»¥ä¸‹å¿…éœ€æ–‡ä»¶ç¼ºå¤±:&quot;</span>)<br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> missing_files:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  - <span class="hljs-subst">&#123;file&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·ç¡®ä¿æ¨¡å‹å·²æ­£ç¡®ä¸‹è½½&quot;</span>)<br>        exit(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… æ‰€æœ‰å¿…éœ€æ¨¡å‹æ–‡ä»¶å­˜åœ¨&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ” éªŒè¯æœ¬åœ°æ¨¡å‹æ–‡ä»¶...&quot;</span>)<br>validate_model_directories()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;â³ åŠ è½½Stable Diffusion 1.5åŸºç¡€æ¨¡å‹...&quot;</span>)<br><span class="hljs-keyword">try</span>:<br>    pipe = StableDiffusionPipeline.from_pretrained(<br>        LOCAL_SD15_PATH,<br>        torch_dtype=torch.float32,<br>        safety_checker=<span class="hljs-literal">None</span><br>    )<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… SD1.5æ¨¡å‹åŠ è½½æˆåŠŸ&quot;</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ SD1.5æ¨¡å‹åŠ è½½å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;â³ åŠ è½½å¹¶åº”ç”¨LCM-LoRAé€‚é…å™¨...&quot;</span>)<br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># ç›´æ¥åŠ è½½LCM-LoRAæƒé‡åˆ°ç®¡é“</span><br>    pipe.load_lora_weights(LOCAL_LCM_LORA_PATH)    <br>    <span class="hljs-comment"># é‡è¦ï¼šèåˆLoRAæƒé‡åˆ°ä¸»æ¨¡å‹</span><br>    pipe.fuse_lora()    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… LCM-LoRAé€‚é…å™¨åŠ è½½æˆåŠŸ&quot;</span>)    <br>    <span class="hljs-comment"># è®¾ç½®LCMè°ƒåº¦å™¨</span><br>    <span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> LCMScheduler<br>    pipe.scheduler = LCMScheduler.from_config(pipe.scheduler.config)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… LCMè°ƒåº¦å™¨è®¾ç½®å®Œæˆ&quot;</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ LCM-LoRAåŠ è½½å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;â³ ä¿å­˜åˆå¹¶åçš„æ¨¡å‹...&quot;</span>)<br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># ä»…ä¿å­˜å¿…è¦çš„ç»„ä»¶</span><br>    pipe.save_pretrained(<br>        MERGED_PATH,<br>        safe_serialization=<span class="hljs-literal">True</span><br>    )<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… åˆå¹¶æ¨¡å‹å·²ä¿å­˜åˆ°: <span class="hljs-subst">&#123;MERGED_PATH&#125;</span>&quot;</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ æ¨¡å‹ä¿å­˜å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    exit(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯<code>01_merge_models.py</code>,ä¸èµ˜è¿° </p><h2 id="è½¬åŒ–åˆ°ONNX"><a href="#è½¬åŒ–åˆ°ONNX" class="headerlink" title="è½¬åŒ–åˆ°ONNX"></a>è½¬åŒ–åˆ°ONNX</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><span class="hljs-keyword">from</span> diffusers <span class="hljs-keyword">import</span> StableDiffusionPipeline<br><span class="hljs-keyword">import</span> onnx<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> warnings<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>warnings.filterwarnings(<span class="hljs-string">&quot;ignore&quot;</span>, category=torch.jit.TracerWarning)<br>warnings.filterwarnings(<span class="hljs-string">&quot;ignore&quot;</span>, category=UserWarning)<br>warnings.filterwarnings(<span class="hljs-string">&quot;ignore&quot;</span>, category=FutureWarning)<br>logging.getLogger(<span class="hljs-string">&quot;transformers&quot;</span>).setLevel(logging.ERROR)<br>logging.getLogger(<span class="hljs-string">&quot;diffusers&quot;</span>).setLevel(logging.ERROR)<br>model_path = <span class="hljs-string">&quot;../working/merged_models&quot;</span>  <span class="hljs-comment"># åˆå¹¶åæ¨¡å‹è·¯å¾„</span><br>onnx_path = <span class="hljs-string">&quot;../working/onnx_models&quot;</span>     <span class="hljs-comment"># ONNXæ¨¡å‹è¾“å‡ºè·¯å¾„</span><br>device = <span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span><br>Path(onnx_path).mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ” éªŒè¯æ¨¡å‹ç›®å½•...&quot;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(model_path):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ é”™è¯¯: æ¨¡å‹ç›®å½•ä¸å­˜åœ¨ - <span class="hljs-subst">&#123;model_path&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·å…ˆè¿è¡Œæ¨¡å‹åˆå¹¶è„šæœ¬&quot;</span>)<br>    sys.exit(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… æ¨¡å‹ç›®å½•éªŒè¯æˆåŠŸ: <span class="hljs-subst">&#123;model_path&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;â³ åŠ è½½åˆå¹¶åçš„æ¨¡å‹ç®¡é“...&quot;</span>)<br>start_time = time.time()<br><span class="hljs-keyword">try</span>:<br>    <span class="hljs-comment"># ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼åŠ è½½æ¨¡å‹</span><br>    pipe = StableDiffusionPipeline.from_pretrained(<br>        model_path, <br>        torch_dtype=torch.float16,<br>        use_safetensors=<span class="hljs-literal">True</span>,<br>        safety_checker=<span class="hljs-literal">None</span>,<br>        feature_extractor=<span class="hljs-literal">None</span>,<br>        requires_safety_checker=<span class="hljs-literal">False</span><br>    ).to(device)    <br>    <span class="hljs-comment"># è®¾ç½®æ¨¡å‹ä¸ºè¯„ä¼°æ¨¡å¼</span><br>    pipe.text_encoder.<span class="hljs-built_in">eval</span>()<br>    pipe.unet.<span class="hljs-built_in">eval</span>()<br>    pipe.vae.<span class="hljs-built_in">eval</span>()    <br>    load_time = time.time() - start_time<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… æ¨¡å‹åŠ è½½æˆåŠŸ! è€—æ—¶: <span class="hljs-subst">&#123;load_time:<span class="hljs-number">.1</span>f&#125;</span>ç§’&quot;</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ æ¨¡å‹åŠ è½½å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    sys.exit(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_onnx_export</span>(<span class="hljs-params">model, args, f, **kwargs</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;å¤„ç†TracerWarningçš„å®‰å…¨å¯¼å‡ºå‡½æ•°&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å¼€å§‹å¯¼å‡ºæ¨¡å‹...&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># ä¸´æ—¶ç¦ç”¨è­¦å‘Š</span><br>        <span class="hljs-keyword">with</span> warnings.catch_warnings():<br>            warnings.simplefilter(<span class="hljs-string">&quot;ignore&quot;</span>)<br>            torch.onnx.export(model, args, f, **kwargs)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  å¯¼å‡ºè¿‡ç¨‹ä¸­å‡ºé”™: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ”„ å¼€å§‹è½¬æ¢Text Encoderåˆ°ONNXæ ¼å¼...&quot;</span>)<br><span class="hljs-keyword">try</span>:<br>    text_encoder = pipe.text_encoder<br>    text_encoder.<span class="hljs-built_in">eval</span>()    <br>    <span class="hljs-comment"># å‡†å¤‡è¾“å…¥</span><br>    input_ids = torch.ones((<span class="hljs-number">1</span>, <span class="hljs-number">77</span>), dtype=torch.long, device=device)   <br>    <span class="hljs-comment"># å¯¼å‡ºONNX</span><br>    encoder_path = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;onnx_path&#125;</span>/text_encoder.onnx&quot;</span>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> safe_onnx_export(<br>        text_encoder,<br>        (input_ids,),<br>        encoder_path,<br>        input_names=[<span class="hljs-string">&quot;input_ids&quot;</span>],<br>        output_names=[<span class="hljs-string">&quot;text_embeddings&quot;</span>],<br>        dynamic_axes=&#123;<br>            <span class="hljs-string">&quot;input_ids&quot;</span>: &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;batch&quot;</span>&#125;,<br>            <span class="hljs-string">&quot;text_embeddings&quot;</span>: &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;batch&quot;</span>&#125;<br>        &#125;,<br>        opset_version=<span class="hljs-number">14</span><br>    ):<br>        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">&quot;Text Encoderå¯¼å‡ºå¤±è´¥&quot;</span>)    <br>    <span class="hljs-comment"># éªŒè¯è¾“å‡º</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… Text Encoderè½¬æ¢æˆåŠŸ! ä¿å­˜åˆ°: <span class="hljs-subst">&#123;encoder_path&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - æ¨¡å‹å¤§å°: <span class="hljs-subst">&#123;os.path.getsize(encoder_path)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>:<span class="hljs-number">.1</span>f&#125;</span> MB&quot;</span>)    <br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ Text Encoderè½¬æ¢å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    sys.exit(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ”„ å¼€å§‹è½¬æ¢UNetåˆ°ONNXæ ¼å¼...&quot;</span>)<br><span class="hljs-keyword">try</span>:<br>    unet = pipe.unet<br>    unet.<span class="hljs-built_in">eval</span>()    <br>    <span class="hljs-comment"># å‡†å¤‡è¾“å…¥ - ä½¿ç”¨æ›´å°çš„batch sizeé¿å…å†…å­˜é—®é¢˜</span><br>    sample = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>).to(device, torch.float16)<br>    timestep = torch.tensor([<span class="hljs-number">1</span>]).to(device, torch.float16)<br>    encoder_hidden_states = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">77</span>, <span class="hljs-number">768</span>).to(device, torch.float16)    <br>    <span class="hljs-comment"># å¯¼å‡ºONNX</span><br>    unet_path = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;onnx_path&#125;</span>/unet.onnx&quot;</span>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> safe_onnx_export(<br>        unet,<br>        (sample, timestep, encoder_hidden_states),<br>        unet_path,<br>        input_names=[<span class="hljs-string">&quot;sample&quot;</span>, <span class="hljs-string">&quot;timestep&quot;</span>, <span class="hljs-string">&quot;encoder_hidden_states&quot;</span>],<br>        output_names=[<span class="hljs-string">&quot;noise_pred&quot;</span>],<br>        dynamic_axes=&#123;<br>            <span class="hljs-string">&quot;sample&quot;</span>: &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;batch&quot;</span>&#125;,<br>            <span class="hljs-string">&quot;encoder_hidden_states&quot;</span>: &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;batch&quot;</span>&#125;,<br>            <span class="hljs-string">&quot;noise_pred&quot;</span>: &#123;<span class="hljs-number">0</span>: <span class="hljs-string">&quot;batch&quot;</span>&#125;<br>        &#125;,<br>        opset_version=<span class="hljs-number">14</span><br>    ):<br>        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">&quot;UNetå¯¼å‡ºå¤±è´¥&quot;</span>)    <br>    <span class="hljs-comment"># éªŒè¯è¾“å‡º</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… UNetè½¬æ¢æˆåŠŸ! ä¿å­˜åˆ°: <span class="hljs-subst">&#123;unet_path&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - æ¨¡å‹å¤§å°: <span class="hljs-subst">&#123;os.path.getsize(unet_path)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>:<span class="hljs-number">.1</span>f&#125;</span> MB&quot;</span>)    <br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ UNetè½¬æ¢å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    sys.exit(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ”„ å¼€å§‹è½¬æ¢VAEè§£ç å™¨åˆ°ONNXæ ¼å¼...&quot;</span>)<br><span class="hljs-keyword">try</span>:<br>    vae = pipe.vae<br>    vae.<span class="hljs-built_in">eval</span>()    <br>    <span class="hljs-comment"># å‡†å¤‡è¾“å…¥ - ä¿®æ­£é€šé“é—®é¢˜</span><br>    <span class="hljs-comment"># æ³¨æ„ï¼šVAEè§£ç å™¨å®é™…æœŸæœ›è¾“å…¥ä¸º [batch, 4, height, width]</span><br>    latent = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>).to(device, torch.float16)    <br>    <span class="hljs-comment"># åˆ›å»ºVAEè§£ç å™¨çš„åŒ…è£…ç±»ï¼Œè§£å†³é€šé“é—®é¢˜</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">VAEDecoderWrapper</span>(torch.nn.Module):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vae</span>):<br>            <span class="hljs-built_in">super</span>().__init__()<br>            <span class="hljs-variable language_">self</span>.decoder = vae.decoder<br>            <span class="hljs-variable language_">self</span>.post_quant_conv = vae.post_quant_conv        <br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, latent</span>):<br>            <span class="hljs-comment"># æ­£ç¡®çš„å¤„ç†æµç¨‹</span><br>            latent = <span class="hljs-variable language_">self</span>.post_quant_conv(latent)<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.decoder(latent)    <br>    <span class="hljs-comment"># ä½¿ç”¨åŒ…è£…åçš„æ¨¡å‹</span><br>    vae_decoder_wrapper = VAEDecoderWrapper(vae).to(device).<span class="hljs-built_in">eval</span>()    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… å·²åˆ›å»ºVAEè§£ç å™¨åŒ…è£…å™¨è§£å†³é€šé“é—®é¢˜&quot;</span>)    <br>    <span class="hljs-comment"># å¯¼å‡ºONNX</span><br>    vae_path = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;onnx_path&#125;</span>/vae_decoder.onnx&quot;</span>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> safe_onnx_export(<br>        vae_decoder_wrapper,<br>        latent,<br>        vae_path,<br>        input_names=[<span class="hljs-string">&quot;latent&quot;</span>],<br>        output_names=[<span class="hljs-string">&quot;image&quot;</span>],<br>        opset_version=<span class="hljs-number">14</span><br>    ):<br>        <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">&quot;VAEè§£ç å™¨å¯¼å‡ºå¤±è´¥&quot;</span>)    <br>    <span class="hljs-comment"># éªŒè¯è¾“å‡º</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… VAEè§£ç å™¨è½¬æ¢æˆåŠŸ! ä¿å­˜åˆ°: <span class="hljs-subst">&#123;vae_path&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - æ¨¡å‹å¤§å°: <span class="hljs-subst">&#123;os.path.getsize(vae_path)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>:<span class="hljs-number">.1</span>f&#125;</span> MB&quot;</span>)    <br>    <span class="hljs-comment"># é¢å¤–éªŒè¯è¾“å‡ºå½¢çŠ¶</span><br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        output = vae_decoder_wrapper(latent)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - è¾“å‡ºå½¢çŠ¶: <span class="hljs-subst">&#123;output.shape&#125;</span> (åº”ä¸º [1, 3, 512, 512])&quot;</span>)    <br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ VAEè§£ç å™¨è½¬æ¢å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    <span class="hljs-comment"># æä¾›è¯¦ç»†é”™è¯¯ä¿¡æ¯</span><br>    <span class="hljs-keyword">import</span> traceback<br>    traceback.print_exc()<br>    sys.exit(<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ› ï¸ å¼€å§‹ä¼˜åŒ–ONNXæ¨¡å‹...&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">optimize_onnx_model</span>(<span class="hljs-params">input_path, output_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä¼˜åŒ–ONNXæ¨¡å‹å¹¶è½¬æ¢ä¸ºFP16&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># ç®€åŒ–æ¨¡å‹</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  æ­£åœ¨ç®€åŒ–æ¨¡å‹: <span class="hljs-subst">&#123;os.path.basename(input_path)&#125;</span>&quot;</span>)<br>        model = onnx.load(input_path)        <br>        <span class="hljs-comment"># ä½¿ç”¨ONNX Simplifier</span><br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">import</span> onnxsim<br>            model_simp, check = onnxsim.simplify(model)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> check:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  è­¦å‘Š: æ¨¡å‹ç®€åŒ–éªŒè¯å¤±è´¥ï¼Œä½†å°†ç»§ç»­ä½¿ç”¨ç®€åŒ–æ¨¡å‹&quot;</span>)<br>            simplified_model = model_simp<br>        <span class="hljs-keyword">except</span> ImportError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  è­¦å‘Š: onnxsimæœªå®‰è£…ï¼Œè·³è¿‡ç®€åŒ–æ­¥éª¤&quot;</span>)<br>            simplified_model = model        <br>        <span class="hljs-comment"># ä¿å­˜ç®€åŒ–åçš„æ¨¡å‹</span><br>        simplified_path = input_path.replace(<span class="hljs-string">&quot;.onnx&quot;</span>, <span class="hljs-string">&quot;_sim.onnx&quot;</span>)<br>        onnx.save(simplified_model, simplified_path)        <br>        <span class="hljs-comment"># è½¬æ¢ä¸ºFP16</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  æ­£åœ¨è½¬æ¢ä¸ºFP16: <span class="hljs-subst">&#123;os.path.basename(input_path)&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">from</span> onnxconverter_common <span class="hljs-keyword">import</span> float16<br>            fp16_model = float16.convert_float_to_float16(simplified_model, keep_io_types=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">except</span> ImportError:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  è­¦å‘Š: onnxconverter-commonæœªå®‰è£…ï¼Œè·³è¿‡FP16è½¬æ¢&quot;</span>)<br>            fp16_model = simplified_model        <br>        <span class="hljs-comment"># ä¿å­˜ä¼˜åŒ–åçš„æ¨¡å‹</span><br>        onnx.save(fp16_model, output_path)        <br>        <span class="hljs-comment"># éªŒè¯ä¼˜åŒ–åçš„æ¨¡å‹</span><br>        <span class="hljs-keyword">try</span>:<br>            onnx.checker.check_model(output_path)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  âœ… æ¨¡å‹éªŒè¯é€šè¿‡&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">except</span> onnx.checker.ValidationError <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  âš ï¸ æ¨¡å‹éªŒè¯è­¦å‘Š: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <span class="hljs-comment"># å³ä½¿æœ‰è­¦å‘Šä¹Ÿç»§ç»­        </span><br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  ä¼˜åŒ–å¤±è´¥: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>success = <span class="hljs-literal">True</span><br><span class="hljs-keyword">for</span> model_name <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;text_encoder&quot;</span>, <span class="hljs-string">&quot;unet&quot;</span>, <span class="hljs-string">&quot;vae_decoder&quot;</span>]:<br>    input_path = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;onnx_path&#125;</span>/<span class="hljs-subst">&#123;model_name&#125;</span>.onnx&quot;</span><br>    output_path = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;onnx_path&#125;</span>/<span class="hljs-subst">&#123;model_name&#125;</span>_fp16.onnx&quot;</span>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nğŸ”§ ä¼˜åŒ– <span class="hljs-subst">&#123;model_name&#125;</span>...&quot;</span>)<br>    <span class="hljs-keyword">if</span> optimize_onnx_model(input_path, output_path):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… <span class="hljs-subst">&#123;model_name&#125;</span>ä¼˜åŒ–æˆåŠŸ! ä¿å­˜åˆ°: <span class="hljs-subst">&#123;output_path&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - ä¼˜åŒ–åå¤§å°: <span class="hljs-subst">&#123;os.path.getsize(output_path)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>:<span class="hljs-number">.1</span>f&#125;</span> MB&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ <span class="hljs-subst">&#123;model_name&#125;</span>ä¼˜åŒ–å¤±è´¥&quot;</span>)<br>        success = <span class="hljs-literal">False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span> + <span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>total_time = time.time() - start_time<br><span class="hljs-keyword">if</span> success:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ğŸ‰ æ‰€æœ‰æ¨¡å‹è½¬æ¢å®Œæˆ! æ€»è€—æ—¶: <span class="hljs-subst">&#123;total_time/<span class="hljs-number">60</span>:<span class="hljs-number">.1</span>f&#125;</span>åˆ†é’Ÿ&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¸‹ä¸€æ­¥: è¿è¡ŒRKNNè½¬æ¢è„šæœ¬&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âš ï¸ è½¬æ¢å®Œæˆä½†æœ‰é”™è¯¯! æ€»è€—æ—¶: <span class="hljs-subst">&#123;total_time/<span class="hljs-number">60</span>:<span class="hljs-number">.1</span>f&#125;</span>åˆ†é’Ÿ&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å»ºè®®: æ£€æŸ¥é”™è¯¯ä¿¡æ¯å¹¶å°è¯•é‡æ–°è¿è¡Œ&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>) <br></code></pre></td></tr></table></figure><p>è¿™æ˜¯<code>02_convert_to_onnx.py</code>è„šæœ¬ï¼Œæœ‰æ³¨é‡Šå’Œå……è¶³çš„è¾“å‡ºæç¤ºï¼Œä¸èµ˜è¿° </p><h2 id="è½¬åŒ–åˆ°RKNN"><a href="#è½¬åŒ–åˆ°RKNN" class="headerlink" title="è½¬åŒ–åˆ°RKNN"></a>è½¬åŒ–åˆ°RKNN</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> rknn.api <span class="hljs-keyword">import</span> RKNN<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> shutil<br>logging.basicConfig(level=logging.INFO, <br>                    <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span>,<br>                    handlers=[<br>                        logging.StreamHandler(),<br>                        logging.FileHandler(<span class="hljs-string">&#x27;rknn_conversion.log&#x27;</span>)<br>                    ])<br>logger = logging.getLogger(<span class="hljs-string">&quot;RKNN_Converter&quot;</span>)<br>BASE_DIR = os.path.dirname(os.path.abspath(__file__))<br>ONNX_MODEL_DIR = os.path.abspath(os.path.join(BASE_DIR, <span class="hljs-string">&quot;./onnx_models&quot;</span>))<br>RKNN_MODEL_DIR = os.path.abspath(os.path.join(BASE_DIR, <span class="hljs-string">&quot;./rknn_models&quot;</span>))<br>CALIB_DATA_DIR = os.path.abspath(os.path.join(BASE_DIR, <span class="hljs-string">&quot;./calib_data&quot;</span>))<br>TARGET_PLATFORM = <span class="hljs-string">&quot;rk3588&quot;</span><br>os.makedirs(RKNN_MODEL_DIR, exist_ok=<span class="hljs-literal">True</span>)<br>os.makedirs(CALIB_DATA_DIR, exist_ok=<span class="hljs-literal">True</span>)<br>SUPPORTED_QUANT_TYPES = &#123;<br>    <span class="hljs-string">&quot;rk3588&quot;</span>: [<span class="hljs-string">&quot;asymmetric_quantized-8&quot;</span>, <span class="hljs-string">&quot;dynamic_fixed_point-8&quot;</span>, <span class="hljs-string">&quot;float16&quot;</span>]<br>&#125;<br>MODEL_CONFIGS = &#123;<br>    <span class="hljs-string">&quot;text_encoder&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;input_nodes&quot;</span>: [<span class="hljs-string">&quot;input_ids&quot;</span>],<br>        <span class="hljs-string">&quot;input_shapes&quot;</span>: [[<span class="hljs-number">1</span>, <span class="hljs-number">77</span>]],<br>        <span class="hljs-string">&quot;calib_data&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;input_ids&quot;</span>: os.path.join(CALIB_DATA_DIR, <span class="hljs-string">&quot;text_encoder_input.npy&quot;</span>)<br>        &#125;,<br>        <span class="hljs-string">&quot;quantized_dtype&quot;</span>: <span class="hljs-string">&quot;asymmetric_quantized-8&quot;</span>,  <span class="hljs-comment"># RK3588æ”¯æŒçš„é‡åŒ–ç±»å‹</span><br>        <span class="hljs-string">&quot;optimization_level&quot;</span>: <span class="hljs-number">3</span>,<br>        <span class="hljs-string">&quot;quantized_method&quot;</span>: <span class="hljs-string">&quot;channel&quot;</span>  <span class="hljs-comment"># é‡åŒ–æ–¹æ³•</span><br>    &#125;,<br>    <span class="hljs-string">&quot;unet&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;input_nodes&quot;</span>: [<span class="hljs-string">&quot;sample&quot;</span>, <span class="hljs-string">&quot;timestep&quot;</span>, <span class="hljs-string">&quot;encoder_hidden_states&quot;</span>],<br>        <span class="hljs-string">&quot;input_shapes&quot;</span>: [[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>], [<span class="hljs-number">1</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">77</span>, <span class="hljs-number">768</span>]],<br>        <span class="hljs-string">&quot;calib_data&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;sample&quot;</span>: os.path.join(CALIB_DATA_DIR, <span class="hljs-string">&quot;unet_sample.npy&quot;</span>),<br>            <span class="hljs-string">&quot;encoder_hidden_states&quot;</span>: os.path.join(CALIB_DATA_DIR, <span class="hljs-string">&quot;unet_emb.npy&quot;</span>)<br>        &#125;,<br>        <span class="hljs-string">&quot;quantized_dtype&quot;</span>: <span class="hljs-string">&quot;asymmetric_quantized-8&quot;</span>,  <span class="hljs-comment"># RK3588æ”¯æŒçš„é‡åŒ–ç±»å‹</span><br>        <span class="hljs-string">&quot;optimization_level&quot;</span>: <span class="hljs-number">2</span>,  <span class="hljs-comment"># é™ä½ä¼˜åŒ–çº§åˆ«é¿å…å†…å­˜é—®é¢˜</span><br>        <span class="hljs-string">&quot;quantized_method&quot;</span>: <span class="hljs-string">&quot;layer&quot;</span>  <span class="hljs-comment"># é‡åŒ–æ–¹æ³•</span><br>    &#125;,<br>    <span class="hljs-string">&quot;vae_decoder&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;input_nodes&quot;</span>: [<span class="hljs-string">&quot;latent&quot;</span>],<br>        <span class="hljs-string">&quot;input_shapes&quot;</span>: [[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>]],<br>        <span class="hljs-string">&quot;calib_data&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;latent&quot;</span>: os.path.join(CALIB_DATA_DIR, <span class="hljs-string">&quot;unet_sample.npy&quot;</span>)  <span class="hljs-comment"># å¤ç”¨UNetçš„æ ·æœ¬</span><br>        &#125;,<br>        <span class="hljs-string">&quot;quantized_dtype&quot;</span>: <span class="hljs-string">&quot;asymmetric_quantized-8&quot;</span>,  <span class="hljs-comment"># RK3588æ”¯æŒçš„é‡åŒ–ç±»å‹</span><br>        <span class="hljs-string">&quot;optimization_level&quot;</span>: <span class="hljs-number">3</span>,<br>        <span class="hljs-string">&quot;quantized_method&quot;</span>: <span class="hljs-string">&quot;channel&quot;</span>  <span class="hljs-comment"># é‡åŒ–æ–¹æ³•</span><br>    &#125;<br>&#125;<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check_model_exists</span>(<span class="hljs-params">model_name</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;æ£€æŸ¥RKNNæ¨¡å‹æ˜¯å¦å·²å­˜åœ¨&quot;&quot;&quot;</span><br>    rknn_path = os.path.join(RKNN_MODEL_DIR, <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;model_name&#125;</span>.rknn&quot;</span>)<br>    <span class="hljs-keyword">if</span> os.path.exists(rknn_path):<br>        logger.info(<span class="hljs-string">f&quot;âœ… æ£€æµ‹åˆ°å·²å­˜åœ¨çš„RKNNæ¨¡å‹: <span class="hljs-subst">&#123;model_name&#125;</span>.rknn&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;   å¤§å°: <span class="hljs-subst">&#123;os.path.getsize(rknn_path)/<span class="hljs-number">1024</span>/<span class="hljs-number">1024</span>:<span class="hljs-number">.1</span>f&#125;</span> MB&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_calib_dataset</span>(<span class="hljs-params">model_name</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;åˆ›å»ºæ ¡å‡†æ•°æ®é›†å¹¶è¿”å›æ–‡ä»¶è·¯å¾„&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># åˆ›å»ºç‰¹å®šäºæ¨¡å‹çš„æ ¡å‡†ç›®å½•</span><br>    model_calib_dir = os.path.join(CALIB_DATA_DIR, <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;model_name&#125;</span>_calib&quot;</span>)<br>    <span class="hljs-keyword">if</span> os.path.exists(model_calib_dir):<br>        shutil.rmtree(model_calib_dir)  <span class="hljs-comment"># æ¸…ç†æ—§æ•°æ®</span><br>    os.makedirs(model_calib_dir, exist_ok=<span class="hljs-literal">True</span>)    <br>    <span class="hljs-comment"># ç”Ÿæˆæ ¡å‡†æ ·æœ¬ (å‡å°‘åˆ°3ä¸ªä»¥åŠ å¿«å¤„ç†)</span><br>    num_samples = <span class="hljs-number">3</span><br>    logger.info(<span class="hljs-string">f&quot;  ç”Ÿæˆ <span class="hljs-subst">&#123;num_samples&#125;</span> ä¸ªæ ¡å‡†æ ·æœ¬...&quot;</span>)    <br>    <span class="hljs-comment"># ä¸ºæ¯ä¸ªè¾“å…¥èŠ‚ç‚¹åˆ›å»ºå•ç‹¬çš„æ•°æ®æ–‡ä»¶</span><br>    input_files = []<br>    <span class="hljs-keyword">for</span> node_name <span class="hljs-keyword">in</span> MODEL_CONFIGS[model_name][<span class="hljs-string">&quot;input_nodes&quot;</span>]:<br>        <span class="hljs-comment"># æ‰¾åˆ°å¯¹åº”çš„è¾“å…¥å½¢çŠ¶</span><br>        shape = <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">for</span> j, node <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(MODEL_CONFIGS[model_name][<span class="hljs-string">&quot;input_nodes&quot;</span>]):<br>            <span class="hljs-keyword">if</span> node == node_name:<br>                shape = MODEL_CONFIGS[model_name][<span class="hljs-string">&quot;input_shapes&quot;</span>][j]<br>                <span class="hljs-keyword">break</span>        <br>        <span class="hljs-keyword">if</span> shape:<br>            <span class="hljs-comment"># ä¸ºæ¯ä¸ªè¾“å…¥èŠ‚ç‚¹åˆ›å»ºæ•°æ®æ–‡ä»¶</span><br>            node_files = []<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_samples):<br>                <span class="hljs-comment"># åˆ›å»ºéšæœºæ•°æ®</span><br>                data_path = os.path.join(model_calib_dir, <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;node_name&#125;</span>_<span class="hljs-subst">&#123;i&#125;</span>.npy&quot;</span>)                <br>                <span class="hljs-comment"># å¯¹äºæ—¶é—´æ­¥é•¿ç‰¹æ®Šå¤„ç†</span><br>                <span class="hljs-keyword">if</span> node_name == <span class="hljs-string">&quot;timestep&quot;</span>:<br>                    data = np.array([i], dtype=np.float32)  <span class="hljs-comment"># ç®€å•é€’å¢</span><br>                <span class="hljs-keyword">else</span>:<br>                    data = np.random.rand(*shape).astype(np.float32)                <br>                np.save(data_path, data)<br>                node_files.append(data_path)            <br>            input_files.append(node_files)    <br>    <span class="hljs-comment"># åˆ›å»ºæ•°æ®é›†æ–‡ä»¶</span><br>    calib_file_path = os.path.join(model_calib_dir, <span class="hljs-string">&quot;calib_dataset.txt&quot;</span>)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(calib_file_path, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-comment"># å†™å…¥æ¯ä¸ªæ ·æœ¬çš„æ•°æ®</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_samples):<br>            sample_line = []<br>            <span class="hljs-keyword">for</span> node_files <span class="hljs-keyword">in</span> input_files:<br>                sample_line.append(node_files[i])<br>            f.write(<span class="hljs-string">&quot; &quot;</span>.join(sample_line) + <span class="hljs-string">&quot;\n&quot;</span>)    <br>    logger.info(<span class="hljs-string">f&quot;  åˆ›å»ºæ ¡å‡†æ•°æ®é›†æ–‡ä»¶: <span class="hljs-subst">&#123;calib_file_path&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> calib_file_path<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_model</span>(<span class="hljs-params">model_name</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è½¬æ¢å•ä¸ªæ¨¡å‹åˆ°RKNNæ ¼å¼&quot;&quot;&quot;</span><br>    logger.info(<span class="hljs-string">f&quot;ğŸš€ å¼€å§‹è½¬æ¢ <span class="hljs-subst">&#123;model_name.upper()&#125;</span> æ¨¡å‹...&quot;</span>)    <br>    <span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦å·²å®Œæˆ</span><br>    <span class="hljs-keyword">if</span> check_model_exists(model_name):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>    <br>    <span class="hljs-comment"># åˆå§‹åŒ–RKNNå¯¹è±¡</span><br>    rknn = RKNN(verbose=<span class="hljs-literal">True</span>)    <br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-comment"># æ­¥éª¤1: é…ç½®å‚æ•°</span><br>        logger.info(<span class="hljs-string">&quot;   è®¾ç½®é…ç½®å‚æ•°...&quot;</span>)        <br>        <span class="hljs-comment"># ä½¿ç”¨RK3588æ”¯æŒçš„é‡åŒ–ç±»å‹</span><br>        quant_type = MODEL_CONFIGS[model_name].get(<span class="hljs-string">&quot;quantized_dtype&quot;</span>, <span class="hljs-string">&quot;asymmetric_quantized-8&quot;</span>)        <br>        <span class="hljs-comment"># éªŒè¯é‡åŒ–ç±»å‹æ˜¯å¦å—æ”¯æŒ</span><br>        <span class="hljs-keyword">if</span> quant_type <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> SUPPORTED_QUANT_TYPES[TARGET_PLATFORM]:<br>            logger.warning(<span class="hljs-string">f&quot;  é‡åŒ–ç±»å‹ <span class="hljs-subst">&#123;quant_type&#125;</span> ä¸è¢« <span class="hljs-subst">&#123;TARGET_PLATFORM&#125;</span> æ”¯æŒï¼Œä½¿ç”¨é»˜è®¤å€¼&quot;</span>)<br>            quant_type = <span class="hljs-string">&quot;asymmetric_quantized-8&quot;</span>        <br>        config_params = &#123;<br>            <span class="hljs-string">&#x27;target_platform&#x27;</span>: TARGET_PLATFORM,<br>            <span class="hljs-string">&#x27;quantized_dtype&#x27;</span>: quant_type,<br>            <span class="hljs-string">&#x27;optimization_level&#x27;</span>: MODEL_CONFIGS[model_name].get(<span class="hljs-string">&quot;optimization_level&quot;</span>, <span class="hljs-number">3</span>),<br>            <span class="hljs-string">&#x27;quantized_method&#x27;</span>: MODEL_CONFIGS[model_name].get(<span class="hljs-string">&quot;quantized_method&quot;</span>, <span class="hljs-string">&quot;channel&quot;</span>),<br>        &#125;        <br>        <span class="hljs-comment"># æ·»åŠ å¯é€‰å‚æ•° - åªä½¿ç”¨å¸ƒå°”å€¼</span><br>        <span class="hljs-keyword">if</span> model_name == <span class="hljs-string">&quot;unet&quot;</span>:<br>            config_params[<span class="hljs-string">&#x27;output_optimize&#x27;</span>] = <span class="hljs-literal">True</span>  <span class="hljs-comment"># åªä¿ç•™output_optimizeå‚æ•°</span><br>            <span class="hljs-comment"># å·²ç§»é™¤sparse_inferå‚æ•°ï¼Œå› ä¸ºrk3588ä¸æ”¯æŒ            </span><br>        logger.info(<span class="hljs-string">f&quot;   é‡åŒ–é…ç½®: <span class="hljs-subst">&#123;config_params[<span class="hljs-string">&#x27;quantized_dtype&#x27;</span>]&#125;</span>&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;   ä¼˜åŒ–çº§åˆ«: <span class="hljs-subst">&#123;config_params[<span class="hljs-string">&#x27;optimization_level&#x27;</span>]&#125;</span>&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;   é‡åŒ–æ–¹æ³•: <span class="hljs-subst">&#123;config_params[<span class="hljs-string">&#x27;quantized_method&#x27;</span>]&#125;</span>&quot;</span>)        <br>        <span class="hljs-comment"># æ£€æŸ¥é…ç½®å‚æ•°æ˜¯å¦æœ‰æ•ˆ</span><br>        logger.info(<span class="hljs-string">&quot;   éªŒè¯é…ç½®å‚æ•°...&quot;</span>)<br>        ret = rknn.config(**config_params)<br>        <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>            logger.error(<span class="hljs-string">f&quot;âŒ é…ç½®å¤±è´¥! é”™è¯¯ç : <span class="hljs-subst">&#123;ret&#125;</span>&quot;</span>)            <br>            <span class="hljs-comment"># å°è¯•ä½¿ç”¨æ›´å®‰å…¨çš„é…ç½®</span><br>            logger.warning(<span class="hljs-string">&quot;âš ï¸ å°è¯•ä½¿ç”¨é»˜è®¤é…ç½®...&quot;</span>)<br>            safe_config = &#123;<br>                <span class="hljs-string">&#x27;target_platform&#x27;</span>: TARGET_PLATFORM,<br>                <span class="hljs-string">&#x27;quantized_dtype&#x27;</span>: <span class="hljs-string">&quot;asymmetric_quantized-8&quot;</span>,<br>                <span class="hljs-string">&#x27;optimization_level&#x27;</span>: <span class="hljs-number">1</span>,<br>            &#125;<br>            ret = rknn.config(**safe_config)<br>            <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>                logger.error(<span class="hljs-string">&quot;âŒ å®‰å…¨é…ç½®ä¹Ÿå¤±è´¥ï¼Œç»ˆæ­¢è½¬æ¢&quot;</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <br>        <span class="hljs-comment"># æ­¥éª¤2: åŠ è½½ONNXæ¨¡å‹</span><br>        onnx_path = os.path.join(ONNX_MODEL_DIR, <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;model_name&#125;</span>_fp16.onnx&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(onnx_path):<br>            logger.error(<span class="hljs-string">f&quot;âŒ ONNXæ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨: <span class="hljs-subst">&#123;onnx_path&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <br>        logger.info(<span class="hljs-string">f&quot;   åŠ è½½ONNXæ¨¡å‹: <span class="hljs-subst">&#123;os.path.basename(onnx_path)&#125;</span>&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;   è¾“å…¥èŠ‚ç‚¹: <span class="hljs-subst">&#123;MODEL_CONFIGS[model_name][<span class="hljs-string">&#x27;input_nodes&#x27;</span>]&#125;</span>&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;   è¾“å…¥å½¢çŠ¶: <span class="hljs-subst">&#123;MODEL_CONFIGS[model_name][<span class="hljs-string">&#x27;input_shapes&#x27;</span>]&#125;</span>&quot;</span>)        <br>        ret = rknn.load_onnx(<br>            model=onnx_path,<br>            inputs=MODEL_CONFIGS[model_name][<span class="hljs-string">&quot;input_nodes&quot;</span>],<br>            input_size_list=MODEL_CONFIGS[model_name][<span class="hljs-string">&quot;input_shapes&quot;</span>]<br>        )<br>        <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>            logger.error(<span class="hljs-string">f&quot;âŒ åŠ è½½ONNXæ¨¡å‹å¤±è´¥! é”™è¯¯ç : <span class="hljs-subst">&#123;ret&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <br>        <span class="hljs-comment"># æ­¥éª¤3: æ„å»ºæ¨¡å‹</span><br>        logger.info(<span class="hljs-string">&quot;   æ„å»ºRKNNæ¨¡å‹...&quot;</span>)        <br>        <span class="hljs-comment"># åˆ›å»ºæ ¡å‡†æ•°æ®é›†æ–‡ä»¶</span><br>        calib_file_path = create_calib_dataset(model_name)        <br>        <span class="hljs-comment"># éªŒè¯æ ¡å‡†æ–‡ä»¶</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(calib_file_path):<br>            logger.error(<span class="hljs-string">f&quot;âŒ æ ¡å‡†æ–‡ä»¶ä¸å­˜åœ¨: <span class="hljs-subst">&#123;calib_file_path&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <br>        <span class="hljs-comment"># æ‰“å°æ ¡å‡†æ–‡ä»¶å†…å®¹ç”¨äºè°ƒè¯•</span><br>        logger.info(<span class="hljs-string">f&quot;   æ ¡å‡†æ–‡ä»¶å†…å®¹é¢„è§ˆ:&quot;</span>)<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(calib_file_path, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            lines = f.readlines()<br>            <span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(lines[:<span class="hljs-built_in">min</span>(<span class="hljs-number">2</span>, <span class="hljs-built_in">len</span>(lines))]):  <span class="hljs-comment"># åªæ˜¾ç¤ºå‰2è¡Œ</span><br>                logger.info(<span class="hljs-string">f&quot;     æ ·æœ¬ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>: <span class="hljs-subst">&#123;line.strip()&#125;</span>&quot;</span>)        <br>        start_time = time.time()        <br>        <span class="hljs-comment"># æ„å»ºå‚æ•° - åªä¿ç•™åŸºæœ¬å‚æ•°</span><br>        build_params = &#123;<br>            <span class="hljs-string">&#x27;do_quantization&#x27;</span>: <span class="hljs-literal">True</span>,<br>            <span class="hljs-string">&#x27;dataset&#x27;</span>: calib_file_path,<br>        &#125;        <br>        <span class="hljs-comment"># å¯¹äºUNetæ¨¡å‹æ·»åŠ ç‰¹æ®Šæç¤º</span><br>        <span class="hljs-keyword">if</span> model_name == <span class="hljs-string">&quot;unet&quot;</span>:<br>            logger.info(<span class="hljs-string">&quot;   UNetæ£€æµ‹åˆ° - ä½¿ç”¨æœ€å°æ„å»ºå‚æ•°&quot;</span>)<br>            logger.info(<span class="hljs-string">&quot;   âš ï¸ æ³¨æ„: UNetè½¬æ¢å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´å’Œè¾ƒå¤§å†…å­˜&quot;</span>)            <br>        ret = rknn.build(**build_params)<br>        build_time = time.time() - start_time        <br>        <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>            logger.error(<span class="hljs-string">f&quot;âŒ æ„å»ºå¤±è´¥! é”™è¯¯ç : <span class="hljs-subst">&#123;ret&#125;</span>&quot;</span>)<br>            logger.error(<span class="hljs-string">&quot;   å¯èƒ½åŸå› : å†…å­˜ä¸è¶³æˆ–ä¸æ”¯æŒçš„ç®—å­&quot;</span>)            <br>            <span class="hljs-comment"># å¯¹äºUNetå°è¯•æ›´ä½ä¼˜åŒ–çº§åˆ«</span><br>            <span class="hljs-keyword">if</span> model_name == <span class="hljs-string">&quot;unet&quot;</span>:<br>                logger.warning(<span class="hljs-string">&quot;âš ï¸ å°è¯•ä½¿ç”¨ä¼˜åŒ–çº§åˆ«0é‡æ–°æ„å»ºUNet...&quot;</span>)<br>                rknn.config(optimization_level=<span class="hljs-number">0</span>)<br>                start_time = time.time()<br>                ret = rknn.build(do_quantization=<span class="hljs-literal">True</span>, dataset=calib_file_path)<br>                build_time = time.time() - start_time<br>                <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>                    logger.error(<span class="hljs-string">&quot;âŒ ä¼˜åŒ–çº§åˆ«0ä¹Ÿå¤±è´¥ï¼Œç»ˆæ­¢è½¬æ¢&quot;</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>                logger.info(<span class="hljs-string">f&quot;   æ„å»ºæˆåŠŸ! è€—æ—¶: <span class="hljs-subst">&#123;build_time:<span class="hljs-number">.1</span>f&#125;</span>ç§’&quot;</span>)        <br>        logger.info(<span class="hljs-string">f&quot;   æ„å»ºæˆåŠŸ! è€—æ—¶: <span class="hljs-subst">&#123;build_time:<span class="hljs-number">.1</span>f&#125;</span>ç§’&quot;</span>)        <br>        <span class="hljs-comment"># æ­¥éª¤4: å¯¼å‡ºRKNNæ¨¡å‹</span><br>        rknn_path = os.path.join(RKNN_MODEL_DIR, <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;model_name&#125;</span>.rknn&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;   å¯¼å‡ºRKNNæ¨¡å‹åˆ°: <span class="hljs-subst">&#123;rknn_path&#125;</span>&quot;</span>)        <br>        ret = rknn.export_rknn(rknn_path)<br>        <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>            logger.error(<span class="hljs-string">f&quot;âŒ å¯¼å‡ºå¤±è´¥! é”™è¯¯ç : <span class="hljs-subst">&#123;ret&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <br>        <span class="hljs-comment"># éªŒè¯æ¨¡å‹å¤§å°</span><br>        <span class="hljs-keyword">if</span> os.path.exists(rknn_path):<br>            size_mb = os.path.getsize(rknn_path) / (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>)<br>            logger.info(<span class="hljs-string">f&quot;âœ… <span class="hljs-subst">&#123;model_name.upper()&#125;</span> è½¬æ¢æˆåŠŸ! å¤§å°: <span class="hljs-subst">&#123;size_mb:<span class="hljs-number">.1</span>f&#125;</span> MB&quot;</span>)            <br>            <span class="hljs-comment"># éªŒè¯æ¨¡å‹æ˜¯å¦å¯ä»¥åŠ è½½</span><br>            logger.info(<span class="hljs-string">&quot;   éªŒè¯æ¨¡å‹åŠ è½½...&quot;</span>)<br>            rknn_lite = RKNN()<br>            ret = rknn_lite.load_rknn(rknn_path)<br>            <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>                logger.warning(<span class="hljs-string">&quot;âš ï¸ æ¨¡å‹åŠ è½½éªŒè¯å¤±è´¥&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                logger.info(<span class="hljs-string">&quot;âœ… æ¨¡å‹åŠ è½½éªŒè¯æˆåŠŸ&quot;</span>)<br>            rknn_lite.release()            <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            logger.error(<span class="hljs-string">&quot;âŒ å¯¼å‡ºæ–‡ä»¶æœªç”Ÿæˆ&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>        <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        logger.error(<span class="hljs-string">f&quot;âŒ è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸: <span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">import</span> traceback<br>        logger.error(traceback.format_exc())<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">finally</span>:<br>        <span class="hljs-comment"># é‡Šæ”¾èµ„æº</span><br>        rknn.release()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    logger.info(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    logger.info(<span class="hljs-string">f&quot;ğŸ“¡ å¼€å§‹RKNNæ¨¡å‹è½¬æ¢ - ç›®æ ‡å¹³å°: <span class="hljs-subst">&#123;TARGET_PLATFORM&#125;</span>&quot;</span>)<br>    logger.info(<span class="hljs-string">f&quot;ğŸ”§ å½“å‰å·¥ä½œç›®å½•: <span class="hljs-subst">&#123;os.getcwd()&#125;</span>&quot;</span>)<br>    logger.info(<span class="hljs-string">f&quot;ğŸ”§ é¡¹ç›®æ ¹ç›®å½•: <span class="hljs-subst">&#123;BASE_DIR&#125;</span>&quot;</span>)<br>    logger.info(<span class="hljs-string">f&quot;ğŸ”§ ONNXæ¨¡å‹ç›®å½•: <span class="hljs-subst">&#123;ONNX_MODEL_DIR&#125;</span>&quot;</span>)<br>    logger.info(<span class="hljs-string">f&quot;ğŸ’¾ RKNNè¾“å‡ºç›®å½•: <span class="hljs-subst">&#123;RKNN_MODEL_DIR&#125;</span>&quot;</span>)<br>    logger.info(<span class="hljs-string">f&quot;ğŸ“Š æ ¡å‡†æ•°æ®ç›®å½•: <span class="hljs-subst">&#123;CALIB_DATA_DIR&#125;</span>&quot;</span>)<br>    logger.info(<span class="hljs-string">f&quot;ğŸ“Š æ”¯æŒçš„é‡åŒ–ç±»å‹: <span class="hljs-subst">&#123;SUPPORTED_QUANT_TYPES[TARGET_PLATFORM]&#125;</span>&quot;</span>)<br>    logger.info(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>        <span class="hljs-comment"># æ£€æŸ¥ç¯å¢ƒ</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(ONNX_MODEL_DIR):<br>        logger.error(<span class="hljs-string">&quot;âŒ é”™è¯¯: ONNXæ¨¡å‹ç›®å½•ä¸å­˜åœ¨&quot;</span>)<br>        logger.error(<span class="hljs-string">&quot;è¯·å…ˆå®ŒæˆONNXè½¬æ¢&quot;</span>)<br>        <span class="hljs-keyword">return</span><br>        <span class="hljs-comment"># ç¡®ä¿æ ¡å‡†æ•°æ®ç›®å½•å­˜åœ¨</span><br>    os.makedirs(CALIB_DATA_DIR, exist_ok=<span class="hljs-literal">True</span>)<br>        <span class="hljs-comment"># è½¬æ¢é¡ºåº - å…ˆè½¬æ¢å°å‹æ¨¡å‹æµ‹è¯•ç¯å¢ƒ</span><br>    models_to_convert = [<span class="hljs-string">&quot;text_encoder&quot;</span>, <span class="hljs-string">&quot;vae_decoder&quot;</span>, <span class="hljs-string">&quot;unet&quot;</span>]<br>    success = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">for</span> model_name <span class="hljs-keyword">in</span> models_to_convert:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> convert_model(model_name):<br>            logger.error(<span class="hljs-string">f&quot;âŒ <span class="hljs-subst">&#123;model_name.upper()&#125;</span> è½¬æ¢å¤±è´¥ï¼Œç»ˆæ­¢æµç¨‹&quot;</span>)<br>            success = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># ç»“æœæŠ¥å‘Š</span><br>    logger.info(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-keyword">if</span> success:<br>        logger.info(<span class="hljs-string">&quot;ğŸ‰ æ‰€æœ‰æ¨¡å‹è½¬æ¢å®Œæˆ!&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;RKNNæ¨¡å‹å·²ä¿å­˜åˆ°: <span class="hljs-subst">&#123;RKNN_MODEL_DIR&#125;</span>&quot;</span>)<br>                <span class="hljs-comment"># æ˜¾ç¤ºæœ€ç»ˆæ¨¡å‹å¤§å°</span><br>        total_size = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> model_name <span class="hljs-keyword">in</span> models_to_convert:<br>            model_path = os.path.join(RKNN_MODEL_DIR, <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;model_name&#125;</span>.rknn&quot;</span>)<br>            <span class="hljs-keyword">if</span> os.path.exists(model_path):<br>                size = os.path.getsize(model_path) / (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>)<br>                total_size += size<br>                logger.info(<span class="hljs-string">f&quot;  - <span class="hljs-subst">&#123;model_name&#125;</span>.rknn: <span class="hljs-subst">&#123;size:<span class="hljs-number">.1</span>f&#125;</span> MB&quot;</span>)        <br>        logger.info(<span class="hljs-string">f&quot;ğŸ’¾ æ€»å¤§å°: <span class="hljs-subst">&#123;total_size:<span class="hljs-number">.1</span>f&#125;</span> MB&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        logger.error(<span class="hljs-string">&quot;ğŸ’¥ è½¬æ¢è¿‡ç¨‹å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ—¥å¿—æ–‡ä»¶&quot;</span>)<br>        logger.info(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br>    logger.info(<span class="hljs-string">&quot;ä¸‹ä¸€æ­¥: å°†RKNNæ¨¡å‹å¤åˆ¶åˆ°Orange Piè¿›è¡Œæ¨ç†&quot;</span>)<br>    logger.info(<span class="hljs-string">&quot;=&quot;</span> * <span class="hljs-number">60</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    start_time = time.time()<br>    main()<br>    logger.info(<span class="hljs-string">f&quot;æ€»è€—æ—¶: <span class="hljs-subst">&#123;(time.time() - start_time)/<span class="hljs-number">60</span>:<span class="hljs-number">.1</span>f&#125;</span> åˆ†é’Ÿ&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯<code>03_convert_to_rknn.py</code>,ä¸èµ˜è¿° </p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†rknnçš„æ¨¡å‹ã€‚ ä¹‹åå°±åªè¦æŠŠæ¨¡å‹å¯¼åˆ°OrangePiä¸Šè¿è¡Œå³å¯ã€‚ </p><h1 id="OrangePié˜¶æ®µ"><a href="#OrangePié˜¶æ®µ" class="headerlink" title="OrangePié˜¶æ®µ"></a>OrangePié˜¶æ®µ</h1><p>webUIç›¸å¯¹çµæ´»ï¼Œæ ·å¼é£æ ¼å¤šï¼Œä¸ç»™å‡ºæ–¹æ³•ï¼Œä»…ç»™å‡ºæ¨ç†è„šæœ¬ã€‚ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> rknnlite.api <span class="hljs-keyword">import</span> RKNNLite<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> logging<br>logging.basicConfig(<br>    level=logging.INFO,<br>    <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span><br>)<br>logger = logging.getLogger(<span class="hljs-string">&quot;SD-RKNN&quot;</span>)<br>MODELS = &#123;<br>    <span class="hljs-string">&quot;text_encoder&quot;</span>: <span class="hljs-string">&quot;rknn_models/text_encoder.rknn&quot;</span>,<br>    <span class="hljs-string">&quot;unet&quot;</span>: <span class="hljs-string">&quot;rknn_models/unet.rknn&quot;</span>,<br>    <span class="hljs-string">&quot;vae_decoder&quot;</span>: <span class="hljs-string">&quot;rknn_models/vae_decoder.rknn&quot;</span><br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">StableDiffusionRKNN</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-variable language_">self</span>.models = &#123;&#125;<br>        <span class="hljs-variable language_">self</span>.rknn_instances = &#123;&#125;<br>        <span class="hljs-variable language_">self</span>.load_models()    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_models</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;åŠ è½½æ‰€æœ‰RKNNæ¨¡å‹&quot;&quot;&quot;</span><br>        logger.info(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)<br>        logger.info(<span class="hljs-string">&quot;ğŸš€ æ­£åœ¨åŠ è½½Stable Diffusionæ¨¡å‹&quot;</span>)<br>        start_time = time.time()        <br>        <span class="hljs-comment"># åŠ è½½é¡ºåºï¼šæ–‡æœ¬ç¼–ç å™¨ -&gt; UNet -&gt; VAEè§£ç å™¨</span><br>        <span class="hljs-variable language_">self</span>.load_model(<span class="hljs-string">&quot;text_encoder&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.load_model(<span class="hljs-string">&quot;unet&quot;</span>)<br>        <span class="hljs-variable language_">self</span>.load_model(<span class="hljs-string">&quot;vae_decoder&quot;</span>)        <br>        logger.info(<span class="hljs-string">f&quot;âœ… æ‰€æœ‰æ¨¡å‹åŠ è½½å®Œæˆ! è€—æ—¶: <span class="hljs-subst">&#123;time.time()-start_time:<span class="hljs-number">.1</span>f&#125;</span>ç§’&quot;</span>)<br>        logger.info(<span class="hljs-string">&quot;=&quot;</span>*<span class="hljs-number">50</span>)    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">load_model</span>(<span class="hljs-params">self, name</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;åŠ è½½å•ä¸ªæ¨¡å‹&quot;&quot;&quot;</span><br>        logger.info(<span class="hljs-string">f&quot;ğŸ”§ åŠ è½½ <span class="hljs-subst">&#123;name&#125;</span> æ¨¡å‹...&quot;</span>)<br>        start_time = time.time()       <br>        rknn = RKNNLite()<br>        path = MODELS[name]        <br>        <span class="hljs-comment"># 1. åŠ è½½RKNNæ¨¡å‹</span><br>        ret = rknn.load_rknn(path)<br>        <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&quot;åŠ è½½ <span class="hljs-subst">&#123;name&#125;</span> æ¨¡å‹å¤±è´¥: é”™è¯¯ç  <span class="hljs-subst">&#123;ret&#125;</span>&quot;</span>)        <br>        <span class="hljs-comment"># 2. åˆå§‹åŒ–è¿è¡Œæ—¶ (ä½¿ç”¨NPUæ ¸å¿ƒ0)</span><br>        ret = rknn.init_runtime(core_mask=RKNNLite.NPU_CORE_0)<br>        <span class="hljs-keyword">if</span> ret != <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&quot;åˆå§‹åŒ– <span class="hljs-subst">&#123;name&#125;</span> è¿è¡Œæ—¶å¤±è´¥: é”™è¯¯ç  <span class="hljs-subst">&#123;ret&#125;</span>&quot;</span>)        <br>        <span class="hljs-variable language_">self</span>.rknn_instances[name] = rknn<br>        logger.info(<span class="hljs-string">f&quot;âœ… <span class="hljs-subst">&#123;name&#125;</span> åŠ è½½æˆåŠŸ! è€—æ—¶: <span class="hljs-subst">&#123;time.time()-start_time:<span class="hljs-number">.1</span>f&#125;</span>ç§’&quot;</span>)    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">text_encoder</span>(<span class="hljs-params">self, input_ids</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;æ–‡æœ¬ç¼–ç å™¨æ¨ç†&quot;&quot;&quot;</span><br>        logger.info(<span class="hljs-string">&quot;ğŸ“ è¿è¡Œæ–‡æœ¬ç¼–ç å™¨...&quot;</span>)<br>        start = time.time()        <br>        <span class="hljs-comment"># æ‰§è¡Œæ¨ç†</span><br>        outputs = <span class="hljs-variable language_">self</span>.rknn_instances[<span class="hljs-string">&quot;text_encoder&quot;</span>].inference(inputs=[input_ids])        <br>        <span class="hljs-comment"># è¿”å›æ–‡æœ¬åµŒå…¥</span><br>        text_embeddings = outputs[<span class="hljs-number">0</span>]<br>        logger.info(<span class="hljs-string">f&quot;âœ… æ–‡æœ¬ç¼–ç å®Œæˆ! è€—æ—¶: <span class="hljs-subst">&#123;time.time()-start:<span class="hljs-number">.2</span>f&#125;</span>ç§’&quot;</span>)<br>        <span class="hljs-keyword">return</span> text_embeddings   <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">unet</span>(<span class="hljs-params">self, latent, timestep, text_embeddings</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;UNetæ¨ç†&quot;&quot;&quot;</span><br>        logger.info(<span class="hljs-string">&quot;ğŸ¨ è¿è¡ŒUNet...&quot;</span>)<br>        start = time.time()        <br>        <span class="hljs-comment"># æ‰§è¡Œæ¨ç†</span><br>        outputs = <span class="hljs-variable language_">self</span>.rknn_instances[<span class="hljs-string">&quot;unet&quot;</span>].inference(<br>            inputs=[latent, timestep, text_embeddings]<br>        )        <br>        <span class="hljs-comment"># è¿”å›å™ªå£°é¢„æµ‹</span><br>        noise_pred = outputs[<span class="hljs-number">0</span>]<br>        logger.info(<span class="hljs-string">f&quot;âœ… UNetå®Œæˆ! è€—æ—¶: <span class="hljs-subst">&#123;time.time()-start:<span class="hljs-number">.2</span>f&#125;</span>ç§’&quot;</span>)<br>        <span class="hljs-keyword">return</span> noise_pred    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">vae_decoder</span>(<span class="hljs-params">self, latent</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;VAEè§£ç å™¨æ¨ç†&quot;&quot;&quot;</span><br>        logger.info(<span class="hljs-string">&quot;ğŸ–¼ï¸ è¿è¡ŒVAEè§£ç å™¨...&quot;</span>)<br>        start = time.time()        <br>        <span class="hljs-comment"># æ‰§è¡Œæ¨ç†</span><br>        outputs = <span class="hljs-variable language_">self</span>.rknn_instances[<span class="hljs-string">&quot;vae_decoder&quot;</span>].inference(inputs=[latent])        <br>        <span class="hljs-comment"># è¿”å›å›¾åƒ</span><br>        image = outputs[<span class="hljs-number">0</span>]<br>        logger.info(<span class="hljs-string">f&quot;âœ… VAEè§£ç å®Œæˆ! è€—æ—¶: <span class="hljs-subst">&#123;time.time()-start:<span class="hljs-number">.2</span>f&#125;</span>ç§’&quot;</span>)<br>        <span class="hljs-keyword">return</span> image    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_image</span>(<span class="hljs-params">self, prompt, steps=<span class="hljs-number">20</span>, guidance_scale=<span class="hljs-number">7.5</span>, seed=<span class="hljs-number">42</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;ç”Ÿæˆå›¾åƒä¸»å‡½æ•°&quot;&quot;&quot;</span><br>        logger.info(<span class="hljs-string">f&quot;\nğŸ¨ å¼€å§‹ç”Ÿæˆå›¾åƒ: &#x27;<span class="hljs-subst">&#123;prompt&#125;</span>&#x27;&quot;</span>)<br>        logger.info(<span class="hljs-string">f&quot;âš™ï¸ å‚æ•°: <span class="hljs-subst">&#123;steps&#125;</span>æ­¥, å¼•å¯¼æ¯”ä¾‹: <span class="hljs-subst">&#123;guidance_scale&#125;</span>, ç§å­: <span class="hljs-subst">&#123;seed&#125;</span>&quot;</span>)        <br>        <span class="hljs-comment"># è®¾ç½®éšæœºç§å­ (ç¡®ä¿å¯é‡å¤æ€§)</span><br>        np.random.seed(seed)        <br>        <span class="hljs-comment"># 1. æ–‡æœ¬ç¼–ç  (ç®€åŒ–å¤„ç†)</span><br>        <span class="hljs-comment"># å®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨åˆ†è¯å™¨å°†promptè½¬æ¢ä¸ºinput_ids</span><br>        input_ids = np.ones((<span class="hljs-number">1</span>, <span class="hljs-number">77</span>), dtype=np.int64)<br>        text_embeddings = <span class="hljs-variable language_">self</span>.text_encoder(input_ids)        <br>        <span class="hljs-comment"># 2. å‡†å¤‡åˆå§‹æ½œåœ¨å˜é‡</span><br>        latents = np.random.randn(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>).astype(np.float32)        <br>        <span class="hljs-comment"># 3. æ‰©æ•£è¿‡ç¨‹</span><br>        <span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(steps):<br>            logger.info(<span class="hljs-string">f&quot;â³ æ‰©æ•£æ­¥éª¤ <span class="hljs-subst">&#123;step+<span class="hljs-number">1</span>&#125;</span>/<span class="hljs-subst">&#123;steps&#125;</span>&quot;</span>)            <br>            <span class="hljs-comment"># æ—¶é—´æ­¥é•¿ (ç®€åŒ–å¤„ç†)</span><br>            t = np.array([step / steps * <span class="hljs-number">1000</span>], dtype=np.float32)            <br>            <span class="hljs-comment"># UNeté¢„æµ‹å™ªå£°</span><br>            noise_pred = <span class="hljs-variable language_">self</span>.unet(latents, t, text_embeddings)            <br>            <span class="hljs-comment"># æ›´æ–°æ½œåœ¨å˜é‡ (ç®€åŒ–å¤„ç†)</span><br>            latents = latents - <span class="hljs-number">0.1</span> * noise_pred        <br>        <span class="hljs-comment"># 4. VAEè§£ç ç”Ÿæˆå›¾åƒ</span><br>        image = <span class="hljs-variable language_">self</span>.vae_decoder(latents)        <br>        <span class="hljs-comment"># 5. åå¤„ç†å¹¶ä¿å­˜å›¾åƒ</span><br>        <span class="hljs-comment"># å°†è¾“å‡ºè½¬æ¢ä¸º0-255èŒƒå›´çš„å›¾åƒ</span><br>        image = image.transpose(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment"># è½¬æ¢ç»´åº¦ (BCHW -&gt; BHWC)</span><br>        image = ((image + <span class="hljs-number">1</span>) * <span class="hljs-number">127.5</span>).clip(<span class="hljs-number">0</span>, <span class="hljs-number">255</span>).astype(np.uint8)        <br>        <span class="hljs-comment"># åˆ›å»ºPILå›¾åƒ</span><br>        img = Image.fromarray(image)<br>        <span class="hljs-keyword">return</span> img    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">release</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;é‡Šæ”¾æ‰€æœ‰æ¨¡å‹èµ„æº&quot;&quot;&quot;</span><br>        logger.info(<span class="hljs-string">&quot;\nğŸ”Œ é‡Šæ”¾æ¨¡å‹èµ„æº...&quot;</span>)<br>        <span class="hljs-keyword">for</span> name, rknn <span class="hljs-keyword">in</span> <span class="hljs-variable language_">self</span>.rknn_instances.items():<br>            rknn.release()<br>            logger.info(<span class="hljs-string">f&quot;âœ… <span class="hljs-subst">&#123;name&#125;</span> å·²é‡Šæ”¾&quot;</span>)<br>sd_instance = <span class="hljs-literal">None</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_sd_instance</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–Stable Diffusionå®ä¾‹ (å•ä¾‹)&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">global</span> sd_instance<br>    <span class="hljs-keyword">if</span> sd_instance <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        sd_instance = StableDiffusionRKNN()<br>    <span class="hljs-keyword">return</span> sd_instance<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># æµ‹è¯•ç”Ÿæˆ</span><br>    sd = get_sd_instance()<br>    <span class="hljs-keyword">try</span>:<br>        user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;type the prompt&quot;</span>)<br>        image = sd.generate_image(user_input, steps=<span class="hljs-number">15</span>)<br>        image.save(<span class="hljs-string">&quot;test_output.png&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… æµ‹è¯•å›¾åƒå·²ä¿å­˜: test_output.png&quot;</span>)<br>    <span class="hljs-keyword">finally</span>:<br>        sd.release()<br></code></pre></td></tr></table></figure><p>è¿è¡Œå®ƒå°±å¯å¾—åˆ°ç»“æœäº† </p><p>æ–¹æ³•å¤šæœ‰ä¸è¶³ï¼Œæœ¬äººåœ¨äººå·¥æ™ºèƒ½æ–¹é¢æ²¡æœ‰ä»€ä¹ˆåŸºç¡€å› æ­¤å¸Œæœ›è¯»è€…å¤šå¤šåŒ…æ¶µã€‚ </p>]]></content>
    
    
    
    <tags>
      
      <tag>æŠ€æœ¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éšç¬”</title>
    <link href="/2024/10/09/%E9%9A%8F%E7%AC%94/"/>
    <url>/2024/10/09/%E9%9A%8F%E7%AC%94/</url>
    
    <content type="html"><![CDATA[<p>ä»Šå¹´è¯ºè´å°”ç‰©ç†å­¦å¥–å±…ç„¶é¢ç»™ç¥ç»ç½‘ç»œäº†ï¼Œè¿™ä¹Ÿæ˜¯é€†å¤©ï¼Œå®¡è¯„æœºæ„æœ‰ä»€ä¹ˆèµ„æ ¼è¿™æ ·é¢å¥–ã€‚<br>è™½ç„¶è¯´ç¥ç»ç½‘ç»œå¯èƒ½è¿ç”¨äº†ç‰©ç†çš„æŸä¸ªåˆ†æ”¯ï¼Œä½†æ˜¯è¿™æ¯•ç«Ÿä¸ç®—ç‰©ç†å­¦çš„æˆå°±ï¼Œå‡å¦‚åº”ç”¨äº†ç‰©ç†çš„å…¶ä»–å­¦ç§‘æˆå°±ä¹Ÿèƒ½ç®—ç‰©ç†æˆå°±çš„è¯ï¼Œé‚£ç™»æœˆè¿˜å¯ä»¥æ‹¿è¯ºè´å°”å¥–äº†ï¼Œ<br>æ‰€ä»¥è¿™ä¸ªè‚¯å®šæ˜¯ä¸åˆç†çš„ã€‚ </p>]]></content>
    
    
    
    <tags>
      
      <tag>å…¶ä»–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºè£…æœº</title>
    <link href="/2024/07/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A3%85%E6%9C%BA/"/>
    <url>/2024/07/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A3%85%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬è¿™ä¸ªç³»åˆ—åªæ˜¯å¤§æ¦‚æä¾›ä¸€ä¸‹ä¸€äº›å¤§å‚çš„ç¡¬ä»¶çš„å‹å·å«ä¹‰,ä¸€äº›æ¥å£æ ‡å‡†ä¹‹ç±»,å¹¶ä¸ä»‹ç»ç†è®ºç¡¬ä»¶çŸ¥è¯†.<br>ç†è®ºç¡¬ä»¶å¯ä»¥ä»¥åå†å‡ºã€‚ </p>]]></content>
    
    
    
    <tags>
      
      <tag>æŠ€æœ¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºè£…æœº(CPU)</title>
    <link href="/2024/07/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A3%85%E6%9C%BA-CPU/"/>
    <url>/2024/07/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A3%85%E6%9C%BA-CPU/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸­å¤®å¤„ç†å™¨(CPU). </p><h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰ï¼Œæ˜¯ç”µå­è®¡ç®—æœºçš„ä¸»è¦è®¾å¤‡ä¹‹ä¸€ï¼Œç”µè„‘ä¸­çš„æ ¸å¿ƒé…ä»¶ã€‚å…¶åŠŸèƒ½ä¸»è¦æ˜¯è§£é‡Šè®¡ç®—æœºæŒ‡ä»¤ä»¥åŠå¤„ç†è®¡ç®—æœºè½¯ä»¶ä¸­çš„æ•°æ®ã€‚CPUæ˜¯è®¡ç®—æœºä¸­è´Ÿè´£è¯»å–<br>æŒ‡ä»¤ï¼Œå¯¹æŒ‡ä»¤è¯‘ç å¹¶æ‰§è¡ŒæŒ‡ä»¤çš„æ ¸å¿ƒéƒ¨ä»¶ã€‚ä¸­å¤®å¤„ç†å™¨ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³æ§åˆ¶å™¨ã€è¿ç®—å™¨ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨åŠå®ç°å®ƒä»¬ä¹‹é—´è”ç³»çš„æ•°æ®ã€æ§åˆ¶çš„<br>æ€»çº¿ã€‚ç”µå­è®¡ç®—æœºä¸‰å¤§æ ¸å¿ƒéƒ¨ä»¶å°±æ˜¯CPUã€å†…éƒ¨å­˜å‚¨å™¨ã€è¾“å…¥&#x2F;è¾“å‡ºè®¾å¤‡ã€‚ä¸­å¤®å¤„ç†å™¨çš„åŠŸæ•ˆä¸»è¦ä¸ºå¤„ç†æŒ‡ä»¤ã€æ‰§è¡Œæ“ä½œã€æ§åˆ¶æ—¶é—´ã€å¤„ç†æ•°æ®ã€‚<br>åœ¨è®¡ç®—æœºä½“ç³»ç»“æ„ä¸­ï¼ŒCPUæ˜¯å¯¹è®¡ç®—æœºçš„æ‰€æœ‰ç¡¬ä»¶èµ„æºï¼ˆå¦‚å­˜å‚¨å™¨ã€è¾“å…¥è¾“å‡ºå•å…ƒï¼‰ è¿›è¡Œæ§åˆ¶è°ƒé…ã€æ‰§è¡Œé€šç”¨è¿ç®—çš„æ ¸å¿ƒç¡¬ä»¶å•å…ƒã€‚CPUæ˜¯è®¡ç®—æœºçš„è¿ç®—å’Œæ§åˆ¶<br>æ ¸å¿ƒã€‚è®¡ç®—æœºç³»ç»Ÿä¸­æ‰€æœ‰è½¯ä»¶å±‚çš„æ“ä½œï¼Œæœ€ç»ˆéƒ½å°†é€šè¿‡æŒ‡ä»¤é›†æ˜ å°„ä¸ºCPUçš„æ“ä½œã€‚ </p><h1 id="å¤§è‡´åˆ†ç±»"><a href="#å¤§è‡´åˆ†ç±»" class="headerlink" title="å¤§è‡´åˆ†ç±»"></a>å¤§è‡´åˆ†ç±»</h1><p>æŒ‰CPUæŒ‡ä»¤é›†æ¶æ„åˆ†ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸º<strong>x86</strong>å’Œ<strong>ARM</strong>ä¸¤ç§ã€‚<br>å…¶ä¸­x86æŒ‰å­—é•¿å¯ä»¥åˆ†ä¸º64ä½å’Œ32ä½ï¼ˆç°åœ¨ï¼Œä»¥å‰ä¹Ÿæœ‰16ä½ç­‰æ›´å°çš„ï¼‰ï¼Œå®ƒä»¬é€šå¸¸ç§°ä¸º<strong>x86-64(æˆ–amd64)<strong>å’Œ</strong>x86</strong>.<br>ä»ç†è®ºä¸Šè®²ä¸€èˆ¬x86ä½¿ç”¨å¤æ‚æŒ‡ä»¤é›†(CISC)åŠŸè€—æ›´å¤§ä½†æ€§èƒ½æ›´å¥½ï¼Œè€ŒARMä½¿ç”¨ç²¾ç®€æŒ‡ä»¤é›†(RISC)åˆ™åˆšå¥½ç›¸åï¼Œæ‰€ä»¥ä¸€èˆ¬PCå’Œå·¥ä½œç«™æœåŠ¡å™¨ä½¿ç”¨x86å¤šï¼Œè€Œç§»åŠ¨è®¾<br>å¤‡ç”¨ARMå¤šã€‚ä½†ä¹Ÿä¸ç»å¯¹ã€‚<br><strong>ä½†ä¹Ÿéœ€æ³¨æ„ï¼ŒRISCè¿˜æœ‰å…¶ä»–æ¶æ„å¦‚RISC-V,LoongArc,MIPSç­‰ï¼Œä½†åœ¨ä¸ªäººç”µè„‘ä¸Šä¸å¸¸è§ã€‚</strong><br>æˆ‘ä»¬ä¸‹æ–‡ä¸€èˆ¬éƒ½è®¨è®ºx86æ¶æ„çš„CPUï¼Œå› ä¸ºä¸ªäººç”µè„‘ä¸Šä½¿ç”¨ARMæ¶æ„çš„ä¸»è¦ä¸ºAppleçš„Må¤„ç†å™¨ï¼Œä¸è£…æœºæ— å…³ã€‚ </p><h1 id="æ€§èƒ½æ•°æ®"><a href="#æ€§èƒ½æ•°æ®" class="headerlink" title="æ€§èƒ½æ•°æ®"></a>æ€§èƒ½æ•°æ®</h1><ul><li>CPUä¸»é¢‘ï¼šå³æ—¶é’Ÿé¢‘ç‡ï¼Œpass </li><li>å¤–é¢‘ï¼šåŸºå‡†é¢‘ç‡ï¼Œå†³å®šä¸»æ¿çš„è¿è¡Œé€Ÿåº¦ï¼Œä¸»é¢‘&#x3D;å¤–é¢‘*å€é¢‘ç³»æ•° </li><li>åˆ¶ç¨‹ï¼šå•ä½nmï¼Œå†³å®šå•ä½é¢ç§¯å¯å®¹çº³çš„æ™¶ä½“ç®¡æ•° </li><li>ç¼“å­˜ï¼šé€Ÿåº¦æé«˜ </li><li>æ€»çº¿é¢‘ç‡ï¼šCPUæ€»çº¿çš„é€Ÿåº¦ï¼ŒCPUæ€»çº¿è¿æ¥CPUä¸å…¶ä»–éƒ¨ä»¶ </li><li>CPUå†…æ ¸å’ŒCPUçº¿ç¨‹ï¼šå†…æ ¸æ•°ä¸ºèŠ¯ç‰‡ç»„çš„æ•°é‡ï¼ŒCPUçº¿ç¨‹åˆç§°é€»è¾‘å¤„ç†å™¨</li></ul><h1 id="å“ç‰ŒåŠå…¶å‹å·è¯´æ˜"><a href="#å“ç‰ŒåŠå…¶å‹å·è¯´æ˜" class="headerlink" title="å“ç‰ŒåŠå…¶å‹å·è¯´æ˜"></a>å“ç‰ŒåŠå…¶å‹å·è¯´æ˜</h1><p>ç›®å‰å¸‚é¢ä¸Šä¸»è¦ä¸ºInterå’ŒAMDã€‚ </p><h2 id="Inter"><a href="#Inter" class="headerlink" title="Inter"></a>Inter</h2><h3 id="Interçš„å­å“ç‰Œ"><a href="#Interçš„å­å“ç‰Œ" class="headerlink" title="Interçš„å­å“ç‰Œ"></a>Interçš„å­å“ç‰Œ</h3><ul><li>é…·ç¿ï¼ˆCoreï¼‰ï¼šæ¡Œé¢ï¼Œé¢å‘ä¸­ã€é«˜ç«¯æ¶ˆè´¹è€…ï¼Œå·¥ä½œç«™å’Œå‘çƒ§çº§åˆ«å¤„ç†å™¨å“ç‰Œ </li><li>å¥”è…¾ï¼ˆPentiumï¼‰ï¼šå…¥é—¨çº§æ¡Œé¢ï¼Œæ¯”é…·ç¿ä½ä¸€ä¸ªçº§åˆ« </li><li>èµ›æ‰¬ï¼ˆCeleronï¼‰ï¼šä½ç«¯æ¡Œé¢ï¼Œä½ç«¯PCï¼Œæ¯”å¥”è…¾ä½ä¸€ä¸ªçº§åˆ« </li><li>å‡ŒåŠ¨ï¼ˆAtomï¼‰ï¼šé¢å‘ç§»åŠ¨è®¾å¤‡ï¼ŒåµŒå…¥å¼è®¾å¤‡ï¼Œå¦‚æ‰‹æœºã€å¹³æ¿ã€ä¸Šç½‘æœ¬ã€å·¥æ§è®¾å¤‡ç­‰ </li><li>å¤¸å…‹ï¼ˆQuarkï¼‰ï¼šé¢å‘æ™ºèƒ½ç©¿æˆ´ã€ç‰©è”ç½‘è®¾å¤‡ï¼Œå·²åœæ­¢å¼€å‘ </li><li>è‡³å¼ºï¼ˆXeonï¼‰ï¼šé¢å‘ä¼ä¸šæœåŠ¡å™¨å’Œå·¥ä½œç«™ </li><li>å®‰è…¾ï¼ˆItaniumï¼‰ï¼šé’ˆå¯¹ä¼ä¸šæœåŠ¡å™¨ã€UNIXå°å‹æœºï¼Œç”¨äºé«˜ç«¯å¸‚åœºï¼Œå·²åœæ­¢å¼€å‘.<br>æˆ‘ä»¬æŒ‡ä»‹ç»é…·ç¿å’Œè‡³å¼ºçš„ç‰ˆæœ¬å·ã€‚</li></ul><h3 id="é…·ç¿-Core"><a href="#é…·ç¿-Core" class="headerlink" title="é…·ç¿(Core)"></a>é…·ç¿(Core)</h3><p>å¦‚Coreâ„¢ i7 7700K</p><h4 id="æ¡£ä½è§„æ ¼"><a href="#æ¡£ä½è§„æ ¼" class="headerlink" title="æ¡£ä½è§„æ ¼"></a>æ¡£ä½è§„æ ¼</h4><p>æœ‰i3,i5,i7,i9å››æ¡£ï¼Œå…¶ä»–æ¡ä»¶ç›¸åŒæ—¶æ•°å­—è¶Šå¤§è¶Šå¥½ã€‚ </p><h4 id="åéšæ•°å­—-åä»£é™¤å¤–"><a href="#åéšæ•°å­—-åä»£é™¤å¤–" class="headerlink" title="åéšæ•°å­—(åä»£é™¤å¤–)"></a>åéšæ•°å­—(åä»£é™¤å¤–)</h4><p>ç¬¬ä¸€ä½æˆ–å‰ä¸¤ä½(å¦‚æœæ˜¯5ä¸ªæ•°å­—å°±æ˜¯å‰ä¸¤ä½)æ˜¯ä»£æ•°ã€‚ä»1åˆ°ç°åœ¨çš„14.å…¶ä»–æ¡ä»¶ç›¸åŒæ—¶ï¼Œä»£æ•°è¶Šå¤§å°±è¶Šå¼ºã€‚<br>åä¸€ä½è¡¨ç¤ºç­‰çº§ï¼Œè¶Šå¤§è¶Šå¥½ï¼Œæœ‰5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9äº”çº§ã€‚<br>å†åä¸€ä½æ˜¯æ ¸æ˜¾å‹å·ï¼Œæœ‰3ï¼Œ5ï¼Œ0ä¸‰ç§ï¼Œ3æŒ‡é«˜æ€§èƒ½å¤„ç†å™¨é…HD4600ï¼Œ5æŒ‡ç”¨Iris5100ï¼Œ5200æˆ–Pro5200ï¼Œ0æŒ‡HD4600.<br>å†åä¸€ä½æŒ‡ç”µå‹è§„æ ¼ï¼Œæœ‰0ï¼Œ2ï¼Œ8ä¸‰ç§ï¼Œåˆ†åˆ«ä¸º47Wï¼Œ37Wï¼Œ28W. </p><h4 id="å°¾æ ‡"><a href="#å°¾æ ‡" class="headerlink" title="å°¾æ ‡"></a>å°¾æ ‡</h4><ul><li>U:ä½ç”µå‹ </li><li>H:é«˜å‹ä¸å¯æ‹†å¸ </li><li>M:ç§»åŠ¨æ ‡å‡† </li><li>G:åæ¥æ•°å­—è¡¨ç¤ºæ ¸æ˜¾ç­‰çº§ </li><li>S:ä½åŠŸè€— </li><li>T:è¶…ä½åŠŸè€— </li><li>Y:è¶…ä½ç”µå‹ </li><li>P:æ— æ˜¾å¡ </li><li>X:è‡³å°Šæ€§èƒ½ </li><li>Q:å››æ ¸å¿ƒæè‡´æ€§èƒ½ </li><li>K:ä¸é”å€é¢‘ </li><li>E:åµŒå…¥å¼å·¥ç¨‹çº§ </li><li>æ— å°¾æ ‡:æ™®é€š</li></ul><h3 id="è‡³å¼º"><a href="#è‡³å¼º" class="headerlink" title="è‡³å¼º"></a>è‡³å¼º</h3><p>å¯ä»¥çœ‹Interè‡ªå·±çš„ä»‹ç»ã€‚<br><a href="https://www.intel.cn/content/www/cn/zh/products/docs/processors/processor-numbers-data-center.html">https://www.intel.cn/content/www/cn/zh/products/docs/processors/processor-numbers-data-center.html</a>  </p><h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p>æˆ‘ä»¬æš‚æ—¶åªä»‹ç»é”é¾™(Ryzen)ç³»åˆ—ã€‚<br>åœ¨ç³»åˆ—åRyzenåè·Ÿçš„æ˜¯å…¶å®šä½ï¼Œåˆ†R9,R7,R5,R3,ç±»ä¼¼ä¸Interçš„ix<br>å†åé¢æ˜¯ä¸€ä¸ªå››ä½æ•°å­—ï¼Œé¦–ä½è¡¨ç¤ºä»£æ•°ï¼Œç›®å‰ä»1000ç³»åˆ—åˆ°8000ç³»åˆ—<br>åä¸‰ä½è¡¨ç¤ºæ€§èƒ½ï¼Œ<del>å…¶å®æœ€åä¸€èˆ¬éƒ½æ˜¯ä¸¤ä¸ª0ï¼Œæ²¡å•¥ç”¨</del>è¶Šå¤§è¶Šå¥½<br>æœ€åæœ‰ä¸ªåç¼€ï¼Œå«ä¹‰å¦‚ä¸‹ï¼š </p><ul><li>X:æ”¯æŒXFRæŠ€æœ¯ï¼Œå¯ä»¥è‡ªåŠ¨è¶…é¢‘ </li><li>G:æœ‰æ ¸æ˜¾ </li><li>3D:ä½¿ç”¨3Dç¼“å­˜ </li><li>WX:æœ€æ–°çš„è¶…å¤šæ ¸å¿ƒçº¿ç¨‹æ’•è£‚è€…ç³»åˆ— </li><li>PRO:æ”¯æŒä¸€äº›ç‰¹åˆ«å®‰å…¨æŠ€æœ¯</li></ul><h1 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h1><p>pass </p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>pass </p>]]></content>
    
    
    
    <tags>
      
      <tag>æŠ€æœ¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºå’–å•¡</title>
    <link href="/2024/07/09/%E5%85%B3%E4%BA%8E%E5%92%96%E5%95%A1/"/>
    <url>/2024/07/09/%E5%85%B3%E4%BA%8E%E5%92%96%E5%95%A1/</url>
    
    <content type="html"><![CDATA[<p>å¯¹å’–å•¡æœ‰ä¸€å®šçš„å…´è¶£å’Œäº†è§£ï¼Œç¼–ä¸€ç¯‡çŸ­æ–‡æ•´åˆä¸€ä¸‹ç½‘ä¸Šå„ç‰ˆæœ¬ã€‚å¦‚æœæ¶‰åŠç‰ˆæƒé—®é¢˜è”ç³»åæœ¬äººä¼šå°½å¿«åˆ é™¤ã€‚  </p><h1 id="å’–å•¡è±†"><a href="#å’–å•¡è±†" class="headerlink" title="å’–å•¡è±†"></a>å’–å•¡è±†</h1><p>å’–å•¡è±†æ˜¯å’–å•¡çš„çµé­‚ã€‚ </p><h2 id="å’–å•¡æ ‘ç§ç±»"><a href="#å’–å•¡æ ‘ç§ç±»" class="headerlink" title="å’–å•¡æ ‘ç§ç±»"></a>å’–å•¡æ ‘ç§ç±»</h2><p>ä¸–ç•Œä¸»æµçš„å’–å•¡æ ‘æœ‰ä¸‰ç§ã€‚<br><strong>1.åˆ©æ¯”é‡Œäºšï¼š</strong><br>äº§è‡ªè¥¿éï¼Œäº§é‡ä½ã€‚<br><strong>2.ç½—å¸ƒæ–¯å¡”ï¼š</strong><br>å‘³é“æœ‰æ˜æ˜¾çš„è‹¦å‘³ï¼Œé…¸åº¦ä½ï¼Œå£æ„Ÿé†‡åšï¼Œå’–å•¡å› å«é‡é«˜ï¼Œå£æ„Ÿä¸€èˆ¬ã€‚é€Ÿæº¶å’–å•¡å’Œå»‰ä»·å’–å•¡çš„é¦–é€‰ï¼Œäº§é‡<br>å 30%~40%ã€‚<br><strong>3.é˜¿æ‹‰æ¯”å¡ï¼š</strong><br>äº§äºåŸƒå¡ä¿„æ¯”äºšï¼Œå“è´¨ä½³ï¼Œæœ‰å¤æ‚çš„é¦™æ°”å’Œè¾ƒé«˜çš„é…¸åº¦ï¼Œæ‰€åˆ¶å’–å•¡å‘³é“å‡è¡¡ã€‚äº§é‡å 65%å·¦å³ã€‚ </p><p>ä¸€èˆ¬ä»å£å‘³çš„å–å‘æ¥çœ‹ï¼Œç¾å›½ä¸æ—¥æœ¬è¾ƒå¸¸é¥®ç”¨é˜¿æ‹‰æ¯”å¡å†²æ³¡çš„æ·¡å’–å•¡ï¼Œæ¬§æ´²åˆ™æ˜¯åå¥½æ··åˆé˜¿æ‹‰æ¯”å¡ä¸ç½—å¸ƒæ–¯å¡”åšæˆçš„æ„å¼æµ“ç¼©å’–å•¡ã€‚ </p><h2 id="å„å’–å•¡è±†ç‰¹ç‚¹äº§åœ°å’Œå£å‘³"><a href="#å„å’–å•¡è±†ç‰¹ç‚¹äº§åœ°å’Œå£å‘³" class="headerlink" title="å„å’–å•¡è±†ç‰¹ç‚¹äº§åœ°å’Œå£å‘³"></a>å„å’–å•¡è±†ç‰¹ç‚¹äº§åœ°å’Œå£å‘³</h2><p>å’–å•¡æ ‘åŸäº§äºåŸƒå¡ä¿„æ¯”äºšï¼Œå±èŒœè‰ç§‘(Rubiaceae),è¯¥ç§‘æ¤ç‰©æœ‰çº¦637å±ï¼Œ10700ç§ä»¥ä¸Šï¼Œå¹¿æ³›åˆ†å¸ƒäºå…¨çƒçƒ­å¸¦<br>å’Œäºšçƒ­å¸¦ï¼Œå°‘æ•°äº§äºæ¸©å¸¦ã€‚å…¶ä¸­å’–å•¡åªé€‚åˆç”Ÿé•¿äºçƒ­å¸¦å’Œäºšçƒ­å¸¦ã€‚é™é›¨é‡ä¹Ÿå¯¹å’–å•¡çš„ç§æ¤å½±å“æå¤§ï¼Œå’–å•¡ç§æ¤åŒº<br>æ•´å¹´çš„é™é›¨é‡å¿…é¡»è¾¾1500~2259mmã€‚é™¤äº†æ°”å€™å’Œé›¨é‡ï¼Œè¿˜è¦æœ‰è‚¥æ²ƒçš„åœŸå£¤å’Œé€‚å®œçš„æµ·æ‹”ç­‰ï¼Œä¸€èˆ¬æ¥è®²ï¼Œæµ·æ‹”è¶Š<br>é«˜è¶Šå¥½ï¼Œä¼˜è´¨çš„å’–å•¡å¤§éƒ½äº§è‡ªé«˜åŸæˆ–å±±åœ°ï¼Œä¸€äº›ä¸­ç¾æ´²äº§åŒºç”šè‡³ä»¥æµ·æ‹”é«˜åº¦æ¥è¯„å®šå’–å•¡çš„ç­‰çº§ã€‚ </p><h3 id="å·´è¥¿"><a href="#å·´è¥¿" class="headerlink" title="å·´è¥¿"></a>å·´è¥¿</h3><p>å·´è¥¿å’–å•¡å¤§å¤šæ•°æ˜¯é˜¿æ‹‰æ¯”å¡(Arabica)å“ç§ï¼Œå…¶æ¬¡æ˜¯ç½—å¸ƒæ–¯å¡”(Robusta)å“ç§ã€‚<br>å·´è¥¿å’–å•¡è±†æœ¬èº«è±†è´¨åè½¯ï¼Œæ²¡æœ‰é«˜æµ·æ‹”å’–å•¡çš„ç¡¬åº¦ä¸æµ“çƒˆçš„é…¸å‘³ï¼Œå¤§å¤šæ•°å·´è¥¿å’–å•¡è±†è±†æ€§å±ä¸­æ€§ï¼šä¸­é…¸ã€å£å‘³æ¸©<br>å’Œè€Œæ»‘æ¶¦ã€é†‡åº¦é€‚ä¸­ã€æœ‰æ·¡æ·¡çš„ç”œå‘³ï¼Œå¯åšå•å“ï¼Œä¹Ÿå¯è·Ÿå…¶ä»–è±†å­æ··åˆã€‚<br><strong>æ•´ä½“å£æ„Ÿï¼š</strong>é†‡åšç”œç¾ï¼Œé…¸åº¦é€‚ä¸­ï¼Œæœ‰ç€ç±»ä¼¼å·§å…‹åŠ›ã€åšæœã€ç„¦ç³–çš„é¦™æ°”ã€‚<br><strong>ä»£è¡¨å“ç§:</strong> </p><ul><li><p>å±±å¤šå£«&#x2F;åœ£å¤šæ–¯å’–å•¡ï¼šå·´è¥¿å„å“ç§ä¸­ä»¥Santosè¾ƒè‘—åã€‚å¯¹äºå·´è¥¿å’–å•¡æ¥è¯´å¹¶æ²¡æœ‰ç‰¹åˆ«å‡ºä¼—çš„ä¼˜ç‚¹ï¼Œä½†æ˜¯ä¹Ÿæ²¡æœ‰<br>æ˜æ˜¾çš„ç¼ºæ†¾ï¼Œè¿™ç§å£å‘³æ¸©å’Œè€Œæ»‘æ¶¦ã€é…¸åº¦ä½ã€é†‡åº¦é€‚ä¸­ï¼Œæœ‰æ·¡æ·¡çš„ç”œå‘³ï¼Œè¿™äº›æ‰€æœ‰æŸ”å’Œçš„å‘³é“æ··åˆåœ¨ä¸€èµ·ï¼Œè¦<br>æƒ³å°†ä»–ä»¬ä¸€ä¸€åˆ†è¾©å‡ºæ¥ï¼Œæ˜¯å¯¹å‘³è•¾çš„æœ€å¥½è€ƒéªŒï¼Œè¿™ä¹Ÿæ˜¯è®¸å¤šå±±åº¦å£«è¿·çˆ±å¥½è¿™ç§å’–å•¡çš„åŸå› ã€‚ </p></li><li><p>æ³¢æ—å’–å•¡ï¼šåœ¨å·´è¥¿ä¸œå—éƒ¨ç±³æ‹‰æ–¯å·(MinasGreais)å¡æ‹‰å¤š(Cerrado)åŒºçš„ä¸€äº›åº„å›­é‡Œç§æ¤ç€å¤è€çš„æ³¢æ—å’–<br>å•¡ã€‚è¿™äº›åº„å›­ï¼Œå¦‚å¡å¹³Â·å¸ƒå…°ç§‘åº„å›­(CapinBranco)å’Œç»´æ–¯å¡”Â·é˜¿è±æ ¼å°”åº„å›­(VistaAllegre)ï¼Œç§æ¤çš„æ³¢æ—<br>è€å“ç§å’–å•¡ä¹Ÿåœ¨å¸‚ä¸Šå‡ºå”®ã€‚å¡å¹³Â·å¸ƒå…°ç§‘å’–å•¡æ¯”ç»´æ–¯å¡”Â·é˜¿è±æ ¼å°”å’–å•¡å£æ„Ÿæ›´æŸ”æ»‘ï¼Œè€Œç»´æ–¯å¡”Â·é˜¿è±æ ¼å°”å’–å•¡æµ“<br>ä¸”é»‘è‰²ï¼Œä¸¤è€…é…¸åº¦è¾ƒä½ã€‚</p></li></ul><p><strong>åšæ³•ï¼š</strong>å·´è¥¿å’–å•¡è±†ï¼Œè±†è´¨åè½¯ï¼Œè±†è¡¨åˆ°è±†èŠ¯çš„åšåº¦è¾ƒè–„ï¼Œæ‰€ä»¥ä¸é€‚åˆé«˜æ¸©çƒ˜ç„™ã€‚å±±å¤šå£«é€‚åˆæ™®é€šç¨‹åº¦çš„çƒ˜<br>ç„™ï¼Œé€‚åˆç”¨æœ€å¤§ä¼—åŒ–çš„æ–¹æ³•å†²æ³¡ï¼Œå¦‚æ„å¤§åˆ©æµ“ç¼©å’–å•¡å’Œå„ç§èŠ±å¼å’–å•¡ã€‚ </p><h3 id="passï¼ˆä»¥åå†è¡¥ï¼‰"><a href="#passï¼ˆä»¥åå†è¡¥ï¼‰" class="headerlink" title="passï¼ˆä»¥åå†è¡¥ï¼‰"></a>passï¼ˆä»¥åå†è¡¥ï¼‰</h3><h1 id="å’–å•¡åˆ¶ä½œ"><a href="#å’–å•¡åˆ¶ä½œ" class="headerlink" title="å’–å•¡åˆ¶ä½œ"></a>å’–å•¡åˆ¶ä½œ</h1><h2 id="å’–å•¡è±†çš„åŠ å·¥"><a href="#å’–å•¡è±†çš„åŠ å·¥" class="headerlink" title="å’–å•¡è±†çš„åŠ å·¥"></a>å’–å•¡è±†çš„åŠ å·¥</h2><ul><li>æ°´æ´—æ³• ï¼šå’–å•¡è±†åŠ å·¥è¿‡ç¨‹æ˜¯æœè‚‰åˆ†ç¦»æœºå»çš®è‚‰â†’å‘é…µåå–å‡ºå’–å•¡è±†â†’æ™’å¹²ã€‚ä¸–ç•Œä¸Šçš„å¤§éƒ¨åˆ†å’–å•¡éƒ½ä½¿ç”¨æ°´æ´—å¤„<br>ç†æ³•ã€‚æ°´æ´—å¤„ç†æ³•èƒ½è®©å’–å•¡çš„äº§åœ°ç‰¹å¾ã€å“ç§ç‰¹å¾å’Œé…¸å‘³åœ¨å’–å•¡æ¯ä¸­é—ªè€€ã€‚è¿™ä¹Ÿæ˜¯ä¸€ç§è¢«ä¸¥æ ¼æ§åˆ¶çš„æ–¹æ³•ï¼Œ<br>èƒ½è®©åŒæ‰¹æ¬¡çš„å’–å•¡é£å‘³ä¸€è‡´ã€‚å¦å¤–ï¼Œå…ˆå»æ‰æœè‚‰å†æ™’å¹²è±†å­ï¼Œå¯ä»¥é™ä½å‡ºé”™çš„æ¦‚ç‡ã€‚  </li><li>æ—¥æ™’æ³• ï¼šåœ¨é‡‡æ‘˜å’–å•¡æœå®åï¼Œå…ˆä¸å»é™¤æœè‚‰ï¼Œè€Œæ˜¯å…ˆæŠŠå’–å•¡æœå®æ™’å¹²åˆ°å¯ä»¥è¢«æœºå™¨å‰¥ç¦»çš„ç¨‹åº¦ã€‚æ­£å› å¦‚æ­¤ï¼Œ<br>å’–å•¡æœå®çš„å‘³é“åœ¨å¹²ç‡¥è¿‡ç¨‹ä¸­ä¼šè¿›å…¥è±†å­ï¼Œè€Œä¸åƒæ°´æ´—æ³•é‚£æ ·è¢«æ´—æ‰ã€‚æ—¥æ™’å¤„ç†æ³•å¸¦æ¥çš„é£å‘³éå¸¸ç‹¬ç‰¹ï¼Œæ¯”<br>æ°´æ´—çš„è±†å­æ°´æœå‘³æ›´æµ“ï¼Œé…¸åº¦æ›´ä½ã€‚  </li><li>æœè‚‰æ—¥æ™’å¤„ç†æ³•&#x2F;èœœå¤„ç†ï¼šå®ƒçš„å¤„ç†è¿‡ç¨‹ä¸æ°´æ´—æ³•ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œå’–å•¡åœ¨ç»è¿‡æœè‚‰åˆ†ç¦»æœºå‰¥ç¦»æœçš®ä¹‹åï¼Œ<br>ç›´æ¥è¿›å…¥å¹²ç‡¥é˜¶æ®µï¼Œéƒ¨åˆ†æœè‚‰ä»ç„¶å®Œå¥½æ— æŸã€‚èœœå¤„ç†çš„å’–å•¡è±†å…·æœ‰ä¸€äº›æ°´æ´—çš„ç‰¹æ€§å’Œä¸€äº›æ—¥æ™’çš„ç‰¹æ€§ï¼Œæ—¢ä¿<br>ç•™äº†æ°´æ´—å’–å•¡çš„é…¸åº¦ï¼Œä¹Ÿè·å¾—äº†æ—¥æ™’å’–å•¡çš„é†‡åšåº¦ã€ç”œæ„Ÿå’Œæ³¥åœŸæ„Ÿï¼Œåªæ˜¯ç¼ºå°‘äº†æµ“éƒçš„æ°´æœå‘³ã€‚</li></ul><h2 id="çƒ˜åŸ¹"><a href="#çƒ˜åŸ¹" class="headerlink" title="çƒ˜åŸ¹"></a>çƒ˜åŸ¹</h2><p>ç›´æ¥çœ‹å›¾ã€‚<br><a href="https://pic3.zhimg.com/v2-5e219e1f749da0ce4cee4fca2cb628ce_r.jpg">çƒ˜åŸ¹</a>  </p><h2 id="ç ”ç£¨"><a href="#ç ”ç£¨" class="headerlink" title="ç ”ç£¨"></a>ç ”ç£¨</h2><p>ç ”ç£¨æ˜¯å±äºå†²æ³¡è¿‡ç¨‹ä¸­çš„å‰æœŸå‡†å¤‡ï¼Œéœ€è¦çš„ç²—ç»†åº¦åªè·Ÿä½ çš„åˆ¶ä½œæ–¹å¼ï¼ˆåˆ¶ä½œå·¥å…·ï¼‰æœ‰å…³ã€‚å™¨å…·ä¸åŒï¼Œæ‰€éœ€çš„ç ”<br>ç£¨ç¨‹åº¦ä¸åŒã€‚å‚è€ƒä¸‹å›¾å³å¯ï¼š<br><a href="https://pic3.zhimg.com/80/v2-ca57cf57df126c033572011d1a798aa6_720w.webp">ç ”ç£¨</a><br>ä¹°å’–å•¡è±†çš„æ—¶å€™ï¼Œå°½é‡ä¸è¦ä¹°å·²ç»ç ”ç£¨å¥½çš„ã€‚å› ä¸ºç£¨å¥½çš„å’–å•¡ç²‰ä¼šå¿«é€Ÿé‡Šæ”¾å’–å•¡é‡Œçš„å‘³é“ï¼Œç‰¹åˆ«æ˜¯æµ…çƒ˜ç„™ï¼Œè¶Šæ–°<br>é²œçš„å’–å•¡è±†å˜è´¨å¾—è¶Šå¿«ã€‚åä¹‹ï¼Œç ”ç£¨å¥½çš„å’–å•¡ç²‰åŸºæœ¬åªæœ‰æ·±çƒ˜ç„™çš„ã€‚æ¨èä¹°ä¸ªç£¨è±†å™¨è‡ªå·±ç ”ç£¨ï¼Œè¿™æ ·å’–å•¡è±†ä¿å­˜<br>èµ·æ¥ä¹Ÿæ›´æ–¹ä¾¿ã€‚ç£¨è±†å™¨æœ‰æ‰‹åŠ¨æœ‰è‡ªåŠ¨çš„ï¼Œä¸€èˆ¬éƒ½å¯ä»¥è°ƒèŠ‚ç²—ç»†ï¼Œæ‰‹åŠ¨çš„ä¼šä¾¿å®œå¾ˆå¤šã€‚å¦‚æœæ²¡æœ‰ç£¨è±†å™¨ï¼Œå¯ä»¥æ ¹æ®<br>è‡ªå·±çš„å†²æ³¡æ–¹å¼è®©åº—é‡Œç°åœºç£¨æˆç²‰ï¼Œç£¨å¥½çš„ç²‰è¦å°½å¿«å–å®Œã€‚</p><p>ç ”ç£¨åº¦è™½ç„¶åˆ†äº†å¥½å‡ æ¡£ï¼Œä½†æ²¡æœ‰ç»å¯¹çš„åˆ’åˆ†ã€‚å¹¶ä¸”æ‰‹ç£¨çš„æ—¶å€™ï¼Œç²—ç ”ç£¨é‡Œä¹Ÿå¯èƒ½æ··äº†ç»†ç ”ç£¨çš„ç²‰ã€‚å› æ­¤ä¸å¿…å¤ªçº ç»“ï¼Œ<br>ç²—ä¸­ç»†é€‰ä¸€ä¸ªå¤§è‡´çš„ç¨‹åº¦ï¼Œå¤šç£¨å‡ æ¬¡æ…¢æ…¢è°ƒèŠ‚ã€‚æ³¨æ°´å¼çš„å™¨å…·ä¸€èˆ¬éƒ½é€‰ç”¨ä¸­åº¦ç ”ç£¨ï¼Œæ ¹æ®ä½ çš„æ»¤æ¯çš„å­”çš„å¤šå°‘æ¥é€‰<br>æ‹©æ˜¯ä¸­ç²—è¿˜æ˜¯ä¸­ç»†ã€‚æœ€æ ¹æœ¬çš„æ˜¯å½±å“æ°´æµçš„é€Ÿåº¦å’Œå†²æ³¡æ—¶é—´ã€‚ä¸€èˆ¬ä¸€ä¸ªå­”çš„é€‰ä¸­ç»†ç ”ç£¨åº¦ã€‚</p><p>ç²—ç ”ç£¨å®¹æ˜“ä¿ç•™å’–å•¡è±†æœ¬æ¥çš„æ¤ç‰©å‘³é“ï¼Œè€Œç»†ç ”ç£¨æ›´å®¹æ˜“èƒå–å’–å•¡å‘³é“ï¼Œé‡Šæ”¾æ›´å¤šçš„å’–å•¡å› ã€‚å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼Œç²—<br>ç ”ç£¨é€‚åˆæµ…ç„™ï¼Œè€Œç»†ç ”ç£¨é€‚åˆæ·±ç„™ï¼Œä½†ä¹Ÿä¸ç»å¯¹ã€‚ä¹‹å‰æåˆ°è¿‡æµ“ç¼©å’–å•¡éƒ½æ˜¯è¶…ç»†ç ”ç£¨çš„ï¼Œå› ä¸ºè¶…ç»†ç ”ç£¨æ›´å®¹æ˜“å¸<br>æ”¶å’–å•¡çš„å‘³é“ã€‚æ‰€ä»¥é€‰æ‹©å™¨å…·ç­‰äºé€‰æ‹©äº†ç ”ç£¨æ–¹å¼ï¼Œä¹Ÿç­‰äºç¡®å®šäº†å‘³é“çš„åå¥½.<br>å‚¨è—ï¼šå’–å•¡è±†&#x2F;ç ”ç£¨å¥½çš„ç²‰æœ€å¥½ç”¨å¯ä»¥å•å‘é€æ°”çš„è¢‹å­è£…ï¼Œå› ä¸ºå®ƒä¼šç¼“æ…¢é‡Šæ”¾æ°”ä½“ã€‚ </p><h2 id="å†²æ³¡"><a href="#å†²æ³¡" class="headerlink" title="å†²æ³¡"></a>å†²æ³¡</h2><p>ç°åšå’–å•¡æŒ‰ç…§åˆ¶ä½œæ–¹å¼ï¼Œåˆå¯ä»¥åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæµ“ç¼©å’–å•¡(Espresso)å’Œèƒå–å’–å•¡(Brew)ã€‚</p><h3 id="æµ“ç¼©"><a href="#æµ“ç¼©" class="headerlink" title="æµ“ç¼©"></a>æµ“ç¼©</h3><p>æµ“ç¼©å’–å•¡ä¹Ÿç»å¸¸è¢«ç§°ä¸ºæ„å¼å’–å•¡ã€‚ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºæµ“ç¼©ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæ˜¯å°½é‡å¤šçš„æŠŠå’–å•¡è±†çš„å‘³é“æå–åˆ°å°‘é‡æ°´é‡Œã€‚<br>å› æ­¤ï¼Œæµ“ç¼©ä¸€èˆ¬éƒ½éœ€è¦æ·±åº¦çƒ˜ç„™+ç»†ç ”ç£¨çš„å’–å•¡è±†ï¼Œå¹¶ä¸”åˆ¶ä½œè¿‡ç¨‹é«˜å‹ï¼Œæ‰èƒ½ä¿è¯å……åˆ†æå–å’–å•¡è±†é‡Œçš„å‘³é“ã€‚ä¸€èˆ¬<br>å’–å•¡åº—é‡Œåšæµ“ç¼©å’–å•¡çš„æœºå™¨ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œåˆ¶ä½œå‡ºé«˜è´¨é‡çš„æµ“ç¼©å’–å•¡æ˜¯å¾ˆçœ‹æœºå™¨çš„ã€‚å½“ç„¶æ‰‹å·¥æ–¹æ³•ï¼ˆå®Œå…¨æµ¸æ³¡å¼ï¼‰ä¹Ÿ<br>å¯ä»¥åˆ¶ä½œå‡ºæµ“ç¼©å’–å•¡ã€‚ä½ å¯èƒ½å–è¿‡ä¸€æ¯é‡åˆå°‘å‘³åˆè‹¦çš„æµ“ç¼©å’–å•¡ï¼Œç„¶åå‘ç°è‡ªå·±å®Œå…¨ä¸å–œæ¬¢å’–å•¡ï¼Œç„¶åç–‘æƒ‘ä¸ºä»€ä¹ˆ<br>Espressoè¿™ä¸ªè¯åœ¨å’–å•¡ç•Œé‡Œè¿™ä¹ˆå‡ºåã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¹³æ—¶å–åˆ°çš„å’–å•¡æ··åˆé¥®å“ï¼Œæ¯”å¦‚æ‹¿é“ã€å¡æ™®å¥‡è¯ºç­‰éƒ½æ˜¯ç”±æµ“<br>ç¼©å’–å•¡å‹¾å…‘è€Œæˆçš„ã€‚é™¤æ­¤ä»¥å¤–ï¼Œæ‰€è°“çš„ç¾å¼å’–å•¡(Caffe Americano, ä¸€ä¸ªæ„å¤§åˆ©æ–‡çš„åå­—)ä¹Ÿæ˜¯æµ“ç¼©å’–å•¡å…‘æ°´<br>å½¢æˆçš„ã€‚è€Œå’–å•¡æœºç”¨çš„å’–å•¡èƒ¶å›Šï¼Œæœ¬è´¨ä¸Šä¹Ÿå¯ä»¥ç®—åšæ˜¯æµ“ç¼©å’–å•¡ã€‚ </p><p>æµ“ç¼©å’–å•¡æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„åˆ†ç±»ã€‚ä¸ºä»€ä¹ˆæµ“ç¼©å’–å•¡åº”ç”¨å¦‚æ­¤å¹¿æ³›ï¼Œé™¤äº†å£æ„Ÿæµ“éƒå’Œé€‚åˆåšå…¶ä»–å’–å•¡é¥®å“çš„åŸæ–™ä»¥å¤–ï¼Œè¿˜<br>æœ‰ä¸€ä¸ªé‡è¦çš„åŸå› æ˜¯æ·±çƒ˜ç„™ã€‚æ·±çƒ˜ç„™çš„å¥½å¤„æœ‰ä¸¤ç‚¹ï¼š1. å’–å•¡è±†å‘³é“å¥½æ§åˆ¶ï¼Œåˆ¶ä½œå‡ºæ¥çš„å’–å•¡å‘³é“å·®å¼‚ä¼šå¾ˆå°ï¼ˆå¤±<br>è´¥ç‡ä½ï¼‰2.æœ€é€‚åˆä¿å­˜å’Œè¿è¾“çš„ã€‚è€Œæ·±çƒ˜ç„™å’–å•¡è±†çš„æœ€ä½³ç”¨é€”å°±æ˜¯åˆ¶ä½œæµ“ç¼©å’–å•¡ã€‚å› æ­¤ï¼Œå’–å•¡è¿é”åº—å‡ºäºå‘³é“è´¨é‡<br>æ§åˆ¶å’ŒåŸæ–™ä¿å­˜è¿™ä¸¤ç‚¹åŸå› ï¼Œæ— ä¸€ä¾‹å¤–çš„éƒ½ä»¥æµ“ç¼©å’–å•¡ä¸ºä¸»ã€‚<br>ç®€å•æ¥è¯´ï¼Œæµ“ç¼©è¿½æ±‚çš„æ˜¯æå°½å¯èƒ½çš„ä»å’–å•¡è±†é‡Œæå–å¤§é‡çš„å’–å•¡å‘³é“ï¼Œè€Œèƒå–åˆ™è¿½æ±‚çš„æ˜¯è®©å’–å•¡å‘³é“ä»¥å¤–çš„é£å‘³å‘<br>æŒ¥å‡ºæ¥ã€‚å› æ­¤ä¸¤ç§åˆ¶ä½œæ–¹å¼åšå‡ºæ¥çš„å’–å•¡ï¼Œå‘³é“ä¸Šæ˜¯éå¸¸ä¸åŒçš„ã€‚<br>æˆ‘è§‰å¾—æœºå™¨èƒå–å½±å“å‘³é“çš„æœ€å¤§çš„é—®é¢˜å…¶å®è¿˜æ˜¯åœ¨å’–å•¡è±†ã€‚åˆšåˆšåœ¨è¯´æµ“ç¼©å’–å•¡æ—¶å°±æåˆ°è¿‡åŸå› ï¼Œåƒå’–å•¡è¿é”åº—ï¼Œè¦<br>ä¿è¯å¤§é‡çš„å’–å•¡è±†çš„è¿è¾“å’Œä¿å­˜ï¼Œè¿˜è¦ä¿æŒå’–å•¡å£å‘³ä¸€è‡´ï¼Œéƒ½ä¼šé‡‡ç”¨æ·±çƒ˜ç„™çš„å’–å•¡è±†ã€‚å’–å•¡è±†ç»è¿‡æ·±çƒ˜ç„™ä¹‹åä¸€å®š<br>ä¼šä¸§å¤±æ‰å¾ˆå¤šé£å‘³ã€‚</p><h3 id="èƒå–"><a href="#èƒå–" class="headerlink" title="èƒå–"></a>èƒå–</h3><p>èƒå–å’–å•¡å’Œæµ“ç¼©å’–å•¡ç›¸æ¯”ï¼Œæœ€å¤§çš„ä¼˜åŠ¿æ˜¯èƒ½æç‚¼å‡ºå’–å•¡å¤æ‚çš„é£å‘³ï¼ŒåŒºåˆ«ä¸åŒå’–å•¡è±†ä¹‹é—´çš„ç‰¹ç‚¹ã€‚èƒå–å’–å•¡é€šå¸¸é™¤<br>äº†åº”è¯¥æœ‰çš„å’–å•¡è‹¦å’Œé…¸ä»¥å¤–ï¼Œè¿˜èƒ½å°åˆ°ç”œå‘³ï¼ŒèŠ±é¦™å‘³ï¼Œæœå®å‘³ç­‰ã€‚èƒå–å’–å•¡&#x2F;æ‰‹å·¥å’–å•¡å°±æ˜¯æ‰€è°“çš„ç°ä»£ç²¾å“å’–å•¡æ‰€<br>è¿½æ±‚çš„æ ¸å¿ƒã€‚å¤§å®¶è¯´çš„æœ€å¤šçš„æ‰‹å†²å’–å•¡ï¼ˆæ³¨æ°´å¼ï¼‰ï¼Œè¿˜æœ‰çœ‹èµ·æ¥åƒåŒ–å­¦å®éªŒçš„è™¹å¸å£¶ï¼ˆå®Œå…¨æµ¸æ³¡å¼ï¼‰ï¼Œéƒ½å±äºèƒå–å’–å•¡ã€‚</p><p>å¦å¤–ï¼Œèƒå–å’–å•¡æœ€å¥½æ˜¯ç›´æ¥é¥®ç”¨ï¼Œå®ƒçš„ä¹è¶£å°±æ˜¯ä½“éªŒå’–å•¡æœ€å¾®å¦™çš„å‘³é“å·®åˆ«ï¼Œå°±ä¸è¦åŠ ä»€ä¹ˆç‰›å¥¶ä¹‹ç±»çš„äº†ã€‚ </p><p>ä»å’–å•¡èƒå–ç¨‹åº¦çš„è§’åº¦ï¼Œå¯ä»¥åˆ†ä¸ºæµ“ç¼©å’–å•¡(Espresso)å’Œèƒå–å’–å•¡(Brew)ã€‚ä»å·¥å…·çš„è§’åº¦ï¼Œä¹Ÿå¯ä»¥åˆ†ä¸ºæœºå™¨å’Œæ‰‹å·¥ã€‚<br>å…¶ä¸­èƒå–å’–å•¡åˆå¯ä»¥åˆ†ä¸ºå®Œå…¨æµ¸æ³¡å¼(Immersion)å’Œæ³¨æ°´æ»´æ»¤å¼(Drip)ã€‚ </p><h4 id="å®Œå…¨æµ¸æ³¡å¼-Immersion-ï¼š"><a href="#å®Œå…¨æµ¸æ³¡å¼-Immersion-ï¼š" class="headerlink" title="å®Œå…¨æµ¸æ³¡å¼(Immersion)ï¼š"></a>å®Œå…¨æµ¸æ³¡å¼(Immersion)ï¼š</h4><p>å®Œå…¨æµ¸æ³¡æ³•å…¶å®å¾ˆç®€å•ï¼Œå°±åƒæ³¡èŒ¶ä¸€æ ·ï¼Œè®©å’–å•¡ç²‰åœ¨çƒ­æ°´é‡Œæµ¸æ³¡ä¸€å®šæ—¶é—´ä¹‹åå†<br>è®©å’–å•¡ç²‰åˆ†ç¦»ï¼Œå°±åšå¥½äº†ä¸€æ¯å’–å•¡ã€‚æŒæ¡å¥½æ°´å’Œå’–å•¡ç²‰çš„æ¯”ä¾‹ï¼Œæ°´æ¸©å’Œæµ¸æ³¡æ—¶é—´å°±å¥½äº†ã€‚å¸¸è§çš„å®Œå…¨æµ¸æ³¡å¼å’–å•¡çš„<br>åˆ¶ä½œå·¥å…·æœ‰ï¼šçˆ±ä¹å‹(AeroPress)ï¼Œæ³•å‹å£¶(Press Pot)ï¼Œè™¹å¸å£¶(Syphon&#x2F;Vacuum)ã€‚è¿™ä¸‰ç§åˆ¶ä½œæ–¹å¼åšå‡ºæ¥<br>çš„å’–å•¡å£æ„Ÿæœ‰æ˜æ˜¾çš„åŒºåˆ«ã€‚ </p><ul><li><strong>æ³•å‹å£¶(Press Pot)</strong> æ˜¯å……åˆ†æµ¸æ³¡ä¹‹åè¿‡æ»¤æ‰å’–å•¡ç²‰ï¼Œåˆ¶ä½œè¿‡ç¨‹ç›¸å¯¹ç®€å•ï¼Œä½†å®¹æ˜“ç•™æ¸£ï¼Œä¹Ÿå®¹æ˜“å‡ºç°è¿‡èƒçš„æƒ…å†µã€‚ </li><li><strong>çˆ±ä¹å‹(AeroPress)</strong> å’Œæ³•å‹å£¶æœ€å¤§çš„ä¸åŒæ˜¯ç”¨å‹åŠ›åŠ é€Ÿèƒå–çš„è¿‡ç¨‹ï¼Œåˆ¶ä½œå¥½çš„å’–å•¡é‡Œä¸ä¼šç•™æ®‹æ¸£ï¼Œèƒå–ç¨‹åº¦<br>ä¸Šä¹Ÿæ›´å®¹æ˜“æ§åˆ¶ã€‚å€¼å¾—ä¸€æçš„æ˜¯çˆ±ä¹å‹æ˜¯å¯ä»¥åˆ¶ä½œå‡ºä¸€æ¯æµ“ç¼©å’–å•¡çš„ã€‚ </li><li><strong>è™¹å¸å£¶(Syphon&#x2F;Vacuum)</strong> ç®€å•çš„æ¥è¯´å…¶å®å°±æ˜¯é€šè¿‡å¯†å°å®¹å™¨é‡Œçš„æ°”ä½“åŠ çƒ­è†¨èƒ€ï¼ŒæŠŠç…®å¥½çš„æ°´å†²åˆ°æœ‰å’–å•¡ç²‰çš„<br>å®¹å™¨é‡Œå®Œæˆæµ¸æ³¡ï¼Œç„¶åç†„ç«è®©ç©ºæ°”é™æ¸©æ”¶ç¼©ï¼Œè®©æ³¡å¥½çš„å’–å•¡å†å›åˆ°ä¹‹å‰çš„å®¹å™¨é‡Œã€‚è¿™ä¸ªè¿‡ç¨‹è®©å†²æ³¡å’Œè¿‡æ»¤å’–å•¡å˜æˆ<br>äº†è‡ªåŠ¨çš„ã€‚è™¹å¸å£¶éœ€è¦çƒ­æºï¼Œæ˜¯æ‰‹å·¥å’–å•¡é‡Œæˆæœ¬æœ€é«˜çš„ï¼ŒåŒæ—¶è¦é€šè¿‡æ°´æ¸©æˆ–åŠ çƒ­ç¨‹åº¦æ¥è°ƒæ•´èƒå–æ—¶é—´ï¼Œå†²æ³¡æŠ€æœ¯è¦<br>æ±‚ä¹Ÿæ˜¯æœ€éš¾çš„ã€‚</li></ul><h4 id="æ³¨æ°´æ»´æ»¤å¼-Drip-ï¼š"><a href="#æ³¨æ°´æ»´æ»¤å¼-Drip-ï¼š" class="headerlink" title="æ³¨æ°´æ»´æ»¤å¼(Drip)ï¼š"></a>æ³¨æ°´æ»´æ»¤å¼(Drip)ï¼š</h4><p>æ³¨æ°´æ»´æ»¤å¼å†²æ³¡ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸å¬åˆ°çš„æ‰‹å†²å’–å•¡ã€‚åœ¨è¿‡æ»¤æ¯ä¸Šé“ºä¸Šæ»¤çº¸ï¼Œåœ¨å€’ä¸Šå’–å•¡ç²‰å†åŠ æ°´ã€‚æ³¨æ°´å¼å†²æ³¡æ˜¯é€šè¿‡æ³¨æ°´çš„<br>é€Ÿåº¦æ¥æ§åˆ¶æ•´ä¸ªèƒå–çš„è¿‡ç¨‹ã€‚è¿‡æ»¤æ¯æœ‰å„ç§å„æ ·çš„é€ å‹ï¼Œä¹Ÿæœ‰å•å­”å’Œå¤šå­”ä¹‹åˆ†ï¼Œä¸åŒçš„è¿‡æ»¤æ¯éœ€è¦çš„ç ”ç£¨ç¨‹åº¦ä¹Ÿä¸åŒ<br>ï¼ˆå‚çœ‹ä¸Šé¢ç ”ç£¨éƒ¨åˆ†çš„é…å›¾ï¼‰ï¼Œä¹Ÿå½±å“æ°´æµé€Ÿåº¦&#x2F;æµ¸æ³¡æ—¶é—´å’Œå’–å•¡ç²‰ä¸æ°´çš„æ¥è§¦é¢ç§¯ã€‚ä¸ºäº†æ›´å¥½çš„æ§åˆ¶æ°´æµï¼Œæœ€å¥½ä½¿ç”¨<br>ç»†å˜´å£¶ã€‚ </p><p>æ³¨æ°´å¼å†²æ³¡å’–å•¡æœ‰ä¸¤ä¸ªå…³é”®æ­¥éª¤ã€‚ç¬¬ä¸€æ˜¯å¼€å§‹åŠ ç²‰ä¹‹å‰ï¼Œå…ˆç”¨çƒ­æ°´æŠŠæ»¤çº¸æµ¸æ¹¿ã€‚è¿™ä¸€æ­¥å¾ˆé‡è¦æ˜¯å› ä¸ºå¦‚æœæ»¤çº¸è·Ÿè¿‡æ»¤æ¯<br>ä¸æœå¸–çš„è¯ä¼šå½±å“æ°´æµé€Ÿåº¦ï¼Œå¦å¤–é€šè¿‡æµ¸æ¹¿éƒ¨åˆ†å¯ä»¥å»é™¤ä¸€ä¸‹æ»¤çº¸å’Œæ®‹ç•™åœ¨è¿‡æ»¤æ¯ä¸Šçš„å‘³é“ã€‚ç¬¬äºŒæ˜¯é—·è’¸ã€‚æ‰€è°“é—·è’¸æ˜¯<br>å…ˆåŠ å°‘é‡çš„æ°´è®©å’–å•¡ç²‰æ¹¿æ¶¦ï¼Œç„¶åé™ç½®20-30ç§’ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è®©å’–å•¡ç²‰å……åˆ†è‹é†’ï¼Œé‡Šæ”¾æ‰ä¸€äº›å½±å“å‘³é“çš„æ°”ä½“ï¼Œè®©å’–<br>å•¡ç²‰åšå¥½å‡†å¤‡è¿›å…¥å†²æ³¡çš„çŠ¶æ€ã€‚è€Œå…³äºæ³¨æ°´æ–¹å¼ï¼Œæœ‰åœ†å½¢ç”»åœˆä¹Ÿæœ‰æ¥å›çš„ï¼Œæœ‰æŒç»­å†²æ³¡ä¹Ÿæœ‰åˆ†æ¬¡å†²æ³¡çš„ï¼Œä¸ªäººè§‰å¾—ç”¨è‡ª<br>å·±æœ€ä¹ æƒ¯çš„ä¸ä¼šå¤±è¯¯çš„æ–¹å¼å°±å¥½ã€‚ </p><h1 id="å’–å•¡çš„é£å‘³"><a href="#å’–å•¡çš„é£å‘³" class="headerlink" title="å’–å•¡çš„é£å‘³"></a>å’–å•¡çš„é£å‘³</h1><p>è§å›¾ã€‚<br><a href="https://pic2.zhimg.com/80/v2-3e81ec69b08f48429ae2abf9aded7ba9_720w.webp">å’–å•¡é£å‘³</a> </p><h1 id="å¸¸è§å’–å•¡ç§ç±»å’Œé…æ–¹"><a href="#å¸¸è§å’–å•¡ç§ç±»å’Œé…æ–¹" class="headerlink" title="å¸¸è§å’–å•¡ç§ç±»å’Œé…æ–¹"></a>å¸¸è§å’–å•¡ç§ç±»å’Œé…æ–¹</h1><ul><li><strong>æµ“ç¼©å’–å•¡(Espresso):</strong> ä¸èµ˜è¿°ã€‚ </li><li><strong>ç¾å¼å’–å•¡(Cafe Americano):</strong> æµ“ç¼©å’–å•¡:æ°´&#x3D;1:2 </li><li><strong>æ‹¿é“(Caffe Latte):</strong> æµ“ç¼©å’–å•¡:ç‰›å¥¶&#x3D;1:2~1:5  </li><li><strong>ç›çªé›…æœµ(Macchiato):</strong> æµ“ç¼©å’–å•¡:å¥¶æ³¡&#x3D;2:1 </li><li><strong>å¡å¸ƒå¥‡è¯º(Cappuccino):</strong> æµ“ç¼©å’–å•¡:çƒ­ç‰›å¥¶:å¥¶æ³¡&#x3D;1:1:1 </li><li><strong>åº·å®è“(Espresso Con Panna):</strong> æµ“ç¼©å’–å•¡:é²œå¥¶æ²¹&#x3D;2:1 </li><li><strong>æ‘©å¡(Mocha):</strong> æµ“ç¼©å’–å•¡:å·§å…‹åŠ›é…±:çƒ­ç‰›å¥¶:é²œå¥¶æ²¹&#x3D;2:1:2:1</li></ul><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ul><li><em><a href="https://www.extrabux.com/chs/guide/6498763">https://www.extrabux.com/chs/guide/6498763</a></em> </li><li><em><a href="https://zhuanlan.zhihu.com/p/125618758">https://zhuanlan.zhihu.com/p/125618758</a></em> </li><li><em><a href="https://zhuanlan.zhihu.com/p/30440708">https://zhuanlan.zhihu.com/p/30440708</a></em> </li><li><em>ã€Šæ¤ç‰©å­¦ã€‹ï¼ˆç¬¬ä¸‰ç‰ˆï¼‰é©¬ç‚œæ¢ï¼Œé«˜ç­‰æ•™è‚²å‡ºç‰ˆç¤¾</em></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>ç”Ÿæ´»åˆ†äº«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è§£å†³hexoä¸Šè½½å¤§æ–‡ä»¶åæŒç»­æŠ¥é”™çš„é—®é¢˜</title>
    <link href="/2024/07/09/%E8%A7%A3%E5%86%B3hexo%E4%B8%8A%E8%BD%BD%E5%A4%A7%E6%96%87%E4%BB%B6%E5%90%8E%E6%8C%81%E7%BB%AD%E6%8A%A5%E9%94%99%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2024/07/09/%E8%A7%A3%E5%86%B3hexo%E4%B8%8A%E8%BD%BD%E5%A4%A7%E6%96%87%E4%BB%B6%E5%90%8E%E6%8C%81%E7%BB%AD%E6%8A%A5%E9%94%99%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>hexoåœ¨ä¸Šè½½è¶…è¿‡100MBçš„æ–‡ä»¶æ—¶ï¼Œç”±äºGithubçš„é™åˆ¶ä¼šæŠ¥é”™ã€‚å¦‚<br><code> remote: error: File xx/xx/xx.x is 118.75 MB; this exceeds   GitHub&#39;s file size limit of 100.00 MB</code><br><code> remote: error: GH001: Large files detected. You may want to try Git Large File Storage - https://git-lfs.github.com.</code>  </p><p>ä¹‹åå³ä½¿ä½ åœ¨æœ¬åœ°ä¸Šåšå„ç§ä¿®æ”¹ï¼Œè­¬å¦‚åˆ é™¤å¤§æ–‡ä»¶ä¹Ÿè¿˜æ˜¯ä¼šæŠ¥å‡ºåŒæ ·çš„é”™è¯¯ï¼Œç›´æ¥å½±å“äº†åç»­æ“ä½œã€‚<br>è€Œç½‘ä¸Šå…³äºè¿™ä¸ªé—®é¢˜çš„æ–‡ç« æœ‰ä¸å¤šï¼Œè€Œä¸”è¿‡äºç®€ç•¥ï¼Œæ‰€ä»¥å°†è‡ªå·±çš„è§£å†³æ–¹æ³•æ”¾å‡ºã€‚ </p><h1 id="é—®é¢˜åˆ†æä¸è§£å†³"><a href="#é—®é¢˜åˆ†æä¸è§£å†³" class="headerlink" title="é—®é¢˜åˆ†æä¸è§£å†³"></a>é—®é¢˜åˆ†æä¸è§£å†³</h1><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ç”±äºæœ¬åœ°æ–‡ä»¶å·²ç»å®Œå…¨åˆ é™¤ï¼Œæ‰€ä»¥é—®é¢˜ä¸ä¼šå‡ºåœ¨çœŸæ­£çš„ä¸Šä¼ æ–‡ä»¶ä¸Šã€‚äº‹å®ä¸Šé—®é¢˜åœ¨äºcommitè®°å½•ï¼Œæˆ‘ä»¬è¦ä»è¿™å…¥æ‰‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç½‘ä¸Šå¾ˆå¤šè§£å†³gitä¸Šè½½çš„æ–¹æ³•åœ¨è¿™é‡Œæ— æ•ˆï¼Œå› ä¸º<br>ä»–ä»¬æ˜¯åœ¨æƒ³åŠæ³•ä¸Šè½½æ–‡ä»¶ï¼Œä½†é—®é¢˜åœ¨è®°å½•ä¸Šã€‚ç°åœ¨æˆ‘ä»¬æ¥è§£å†³é—®é¢˜ã€‚ </p><h2 id="è§£å†³ï¼ˆå›¾ä»¥åå†è¡¥ï¼‰"><a href="#è§£å†³ï¼ˆå›¾ä»¥åå†è¡¥ï¼‰" class="headerlink" title="è§£å†³ï¼ˆå›¾ä»¥åå†è¡¥ï¼‰"></a>è§£å†³ï¼ˆå›¾ä»¥åå†è¡¥ï¼‰</h2><p>åœ¨githubçš„ç•Œé¢ä¸Šç‚¹å‡»Actionsï¼Œç„¶åä½ å¯ä»¥çœ‹åˆ°ä¸‹é¢æ˜¯ä½ çš„æäº¤åˆ—è¡¨ã€‚<br>ç‚¹å‡»æœ€æ–°çš„â€pages build and deploymentâ€ï¼Œæ–°ç•Œé¢ä¸­ï¼Œåœ¨ç”¨æˆ·åå³è¾¹æœ‰ä¸€ä¸²å­—ç¬¦ï¼Œç‚¹å‡» ã€‚<br>åœ¨æ–°ç•Œé¢ä¸­ï¼Œå¤åˆ¶æœ€å³æ–¹çš„commitã€‚<br>åœ¨æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹çš„.deploy_gitæ–‡ä»¶å¤¹ï¼ˆéšè—æ–‡ä»¶ï¼‰ä¸­æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥<br><code>git reset --hard commitID</code><br>commitIDè¦ç”¨å¤åˆ¶çš„æ›¿æ¢ã€‚<br>æœ€åç”¨<br><code>hexo d -g</code><br>å®Œæˆã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å»ºç«™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸€åˆ‡çš„æ–°å¼€å§‹</title>
    <link href="/2024/07/07/%E4%B8%80%E5%88%87%E7%9A%84%E6%96%B0%E5%BC%80%E5%A7%8B/"/>
    <url>/2024/07/07/%E4%B8%80%E5%88%87%E7%9A%84%E6%96%B0%E5%BC%80%E5%A7%8B/</url>
    
    <content type="html"><![CDATA[<p>2024&#x2F;7&#x2F;8ç½‘ç«™ç¿»æ–°ï¼Œè¯¦è§â€œaboutâ€ </p><h2 id="æœ¬ç½‘ç«™æ ‡ç­¾è¯´æ˜"><a href="#æœ¬ç½‘ç«™æ ‡ç­¾è¯´æ˜" class="headerlink" title="æœ¬ç½‘ç«™æ ‡ç­¾è¯´æ˜"></a>æœ¬ç½‘ç«™æ ‡ç­¾è¯´æ˜</h2><ol><li>Blogï¼šå³æ­£å¸¸ç”Ÿæ´»æ‰€é—»æ‰€è§æ‰€æ„Ÿã€‚ </li><li>ç”Ÿæ´»åˆ†äº«ï¼šå³ç”Ÿæ´»ä¸ŠçŸ¥è¯†çš„åˆ†äº«ã€‚ </li><li>èµ„æºåˆ†äº«ï¼šåˆ†äº«æ–‡ä»¶ï¼Œç½‘ç«™ç­‰ã€‚ </li><li>é€šå‘Šï¼šä¸æ­¤ç½‘ç«™æœ‰å…³çš„å†…å®¹ã€‚</li><li>å…¶ä»–ï¼šæœ‰ä¸“ä¸šæ€§çš„ä»¥å…·ä½“é—¨ç±»å®šæ ‡ç­¾ã€‚</li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>é€šå‘Š</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
